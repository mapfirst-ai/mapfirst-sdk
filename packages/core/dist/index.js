"use strict";var T=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var V=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})},j=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of G(e))!F.call(t,n)&&n!==r&&T(t,n,{get:()=>e[n],enumerable:!(a=_(e,n))||a.enumerable});return t};var R=t=>j(T({},"__esModule",{value:!0}),t);var ie={};V(ie,{MapFirstCore:()=>S});module.exports=R(ie);function C(t,e){var l,i,d;if(typeof document=="undefined")return null;let r=t.marker,n=r.type==="Accommodation"&&((i=(l=r.pricing)==null?void 0:l.offer)==null?void 0:i.availability)!=="available",o=document.createElement("div");o.style.display="flex",o.style.zIndex="10",o.style.alignItems="center",o.style.justifyContent="center",o.style.pointerEvents="auto";let s=document.createElement("button");return s.type="button",s.style.width="20px",s.style.height="20px",s.style.borderRadius="999px",s.style.border="2px solid #ffffff",s.style.boxShadow="0 2px 4px rgba(107, 114, 128, 0.4)",s.style.transition="transform 0.2s",s.style.outline="none",s.style.transformOrigin="center center",s.title=(d=r.name)!=null?d:String(r.tripadvisor_id),n?(s.style.background="#d1d5db",s.style.cursor="default"):(s.style.background="#012b11",s.style.cursor="pointer"),s.addEventListener("mouseenter",()=>{n||(s.style.transform="scale(1.2)")}),s.addEventListener("mouseleave",()=>{s.style.transform="scale(1)"}),s.addEventListener("focus",()=>{n||(s.style.outline="2px solid #ffffff",s.style.outlineOffset="2px")}),s.addEventListener("blur",()=>{s.style.outline="none"}),s.addEventListener("click",f=>{f.stopPropagation(),n||e==null||e(r)}),o.appendChild(s),o}var Z='<svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M12 3.953a7.442 7.442 0 1 0 .001 14.884A7.442 7.442 0 0 0 12 3.953m0 14.05a6.61 6.61 0 1 1 0-13.218 6.61 6.61 0 0 1 0 13.219M10.343 11.9a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.821 0m5.134 0a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.82 0m.82-1.897.84-.913h-1.863A5.8 5.8 0 0 0 12 8.08a5.77 5.77 0 0 0-3.27 1.008H6.862l.84.913a2.567 2.567 0 1 0 3.475 3.78l.823.896.823-.895a2.568 2.568 0 1 0 3.474-3.78m-6.865 3.634a1.738 1.738 0 1 1 0-3.476 1.738 1.738 0 0 1 0 3.476M12 11.85c0-1.143-.832-2.124-1.929-2.543A5 5 0 0 1 12 8.92a5 5 0 0 1 1.928.386c-1.096.42-1.927 1.4-1.927 2.543m2.566 1.787a1.738 1.738 0 1 1 .001-3.476 1.738 1.738 0 0 1 0 3.476m-8.456 3.719s-.377-.946-1.396-1.903c-1.02-.957-2.303-1.132-2.303-1.132s.457 1.02 1.54 2.04c1.086 1.017 2.159.995 2.159.995m2.568 1.41s-.524-.511-1.479-.883-1.861-.191-1.861-.191.598.54 1.615.935c1.016.397 1.725.139 1.725.139m2.493.505s-.545-.224-1.357-.196-1.415.47-1.415.47.608.222 1.473.193 1.3-.467 1.3-.467m-6.186-4.203s-.175-1.008-.974-2.154c-.8-1.147-2.015-1.578-2.015-1.578s.238 1.098 1.089 2.319c.85 1.22 1.9 1.413 1.9 1.413m-1.003-3.071s.195-1.021-.134-2.393c-.328-1.371-1.294-2.21-1.294-2.21s-.17 1.128.18 2.589c.35 1.46 1.248 2.014 1.248 2.014"></path><path d="M17.887 17.355s.377-.946 1.396-1.903c1.02-.957 2.303-1.132 2.303-1.132s-.457 1.02-1.54 2.04c-1.086 1.017-2.159.995-2.159.995m-2.567 1.41s.524-.511 1.479-.883 1.861-.191 1.861-.191-.598.54-1.615.935c-1.016.397-1.725.139-1.725.139m-2.493.505s.545-.224 1.357-.196 1.415.47 1.415.47-.608.222-1.473.193-1.3-.467-1.3-.467m6.186-4.203s.175-1.008.974-2.154c.8-1.147 2.015-1.578 2.015-1.578s-.238 1.098-1.089 2.319c-.85 1.22-1.9 1.413-1.9 1.413m1.003-3.071s-.195-1.021.133-2.393c.33-1.371 1.293-2.21 1.293-2.21s.17 1.128-.18 2.589c-.349 1.46-1.246 2.014-1.246 2.014M12 20.047a.413.413 0 1 0 0-.827.413.413 0 0 0 0 .827"></path></svg>',W='<svg viewBox="0 0 24 24" width="32" height="32"><path d="M12 3.953a7.442 7.442 0 1 0 .001 14.884A7.442 7.442 0 0 0 12 3.953m0 14.05a6.61 6.61 0 1 1 0-13.218 6.61 6.61 0 0 1 0 13.219M10.343 11.9a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.821 0m5.134 0a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.82 0m.82-1.897.84-.913h-1.863A5.8 5.8 0 0 0 12 8.08a5.77 5.77 0 0 0-3.27 1.008H6.862l.84.913a2.567 2.567 0 1 0 3.475 3.78l.823.896.823-.895a2.568 2.568 0 1 0 3.474-3.78m-6.865 3.634a1.738 1.738 0 1 1 0-3.476 1.738 1.738 0 0 1 0 3.476M12 11.85c0-1.143-.832-2.124-1.929-2.543A5 5 0 0 1 12 8.92a5 5 0 0 1 1.928.386c-1.096.42-1.927 1.4-1.927 2.543m2.566 1.787a1.738 1.738 0 1 1 .001-3.476 1.738 1.738 0 0 1 0 3.476m-8.456 3.719s-.377-.946-1.396-1.903c-1.02-.957-2.303-1.132-2.303-1.132s.457 1.02 1.54 2.04c1.086 1.017 2.159.995 2.159.995m2.568 1.41s-.524-.511-1.479-.883-1.861-.191-1.861-.191.598.54 1.615.935c1.016.397 1.725.139 1.725.139m2.493.505s-.545-.224-1.357-.196-1.415.47-1.415.47.608.222 1.473.193 1.3-.467 1.3-.467m-6.186-4.203s-.175-1.008-.974-2.154c-.8-1.147-2.015-1.578-2.015-1.578s.238 1.098 1.089 2.319c.85 1.22 1.9 1.413 1.9 1.413m-1.003-3.071s.195-1.021-.134-2.393c-.328-1.371-1.294-2.21-1.294-2.21s-.17 1.128.18 2.589c.35 1.46 1.248 2.014 1.248 2.014"></path><path d="M17.887 17.355s.377-.946 1.396-1.903c1.02-.957 2.303-1.132 2.303-1.132s-.457 1.02-1.54 2.04c-1.086 1.017-2.159.995-2.159.995m-2.567 1.41s.524-.511 1.479-.883 1.861-.191 1.861-.191-.598.54-1.615.935c-1.016.397-1.725.139-1.725.139m-2.493.505s.545-.224 1.357-.196 1.415.47 1.415.47-.608.222-1.473.193-1.3-.467-1.3-.467m6.186-4.203s.175-1.008.974-2.154c.8-1.147 2.015-1.578 2.015-1.578s-.238 1.098-1.089 2.319c-.85 1.22-1.9 1.413-1.9 1.413m1.003-3.071s-.195-1.021.133-2.393c.33-1.371 1.293-2.21 1.293-2.21s.17 1.128-.18 2.589c-.349 1.46-1.246 2.014-1.246 2.014M12 20.047a.413.413 0 1 0 0-.827.413.413 0 0 0 0 .827"></path></svg>',K='<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.051 6.549v.003l1.134 1.14 3.241-3.25.003-.002 1.134 1.136-3.243 3.252 1.134 1.14a1 1 0 0 0 .09-.008c.293-.05.573-.324.72-.474l.005-.006 2.596-2.603L22 8.016l-2.597 2.604a3.73 3.73 0 0 1-1.982 1.015 4.3 4.3 0 0 1-3.162-.657l-.023-.016-.026-.018-1.366 1.407 8.509 8.512L20.219 22l-.002-.002-6.654-6.663-2.597 2.76-7.3-7.315C1.967 8.948 1.531 6.274 2.524 4.198c.241-.504.566-.973.978-1.386l8.154 8.416 1.418-1.423-.039-.045c-.858-1.002-1.048-2.368-.62-3.595a4.15 4.15 0 0 1 .983-1.561L16 2l1.135 1.138-2.598 2.602-.047.045c-.16.151-.394.374-.433.678zM3.809 5.523c-.362 1.319-.037 2.905 1.06 4.103L10.93 15.7l1.408-1.496zM2.205 20.697 3.34 21.84l4.543-4.552-1.135-1.143z"/></svg>',$='<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.56 7.5H3.75a.25.25 0 0 0-.25.25v10c0 .138.112.25.25.25h16.5a.25.25 0 0 0 .25-.25v-10a.25.25 0 0 0-.25-.25h-3.81l-2-2H9.56zM8.94 4h6.12l2 2h3.19c.966 0 1.75.784 1.75 1.75v10a1.75 1.75 0 0 1-1.75 1.75H3.75A1.75 1.75 0 0 1 2 17.75v-10C2 6.784 2.784 6 3.75 6h3.19z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12 9.25a2.75 2.75 0 1 0 0 5.5 2.75 2.75 0 0 0 0-5.5M7.75 12a4.25 4.25 0 1 1 8.5 0 4.25 4.25 0 0 1-8.5 0"/></svg>';function P(t,e){var f,v,A,x,g,p,u,y;if(typeof document=="undefined")return null;let r=t.marker,a=r.type==="Accommodation",n=(v=(f=r.pricing)==null?void 0:f.offer)==null?void 0:v.displayPrice,o=a&&!n,s=(()=>{if(r.rating===void 0||r.rating===null)return null;let m=typeof r.rating=="number"?r.rating:Number(r.rating);return Number.isNaN(m)||m<=0?null:m.toFixed(1)})(),l=document.createElement("div");l.style.display="flex",l.style.zIndex="20",l.style.flexDirection="column",l.style.alignItems="center",l.style.pointerEvents="auto";let i=document.createElement("button");if(i.type="button",i.style.border="2px solid",i.style.borderRadius="999px",i.style.padding="8px 8px",i.style.fontSize="16px",i.style.fontWeight="600",i.style.fontFamily="system-ui, -apple-system, sans-serif",i.style.boxShadow="0 4px 6px rgba(107, 114, 128, 0.5)",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.position="relative",i.style.transition="transform 0.2s",i.style.transformOrigin="center bottom",i.title=(A=r.name)!=null?A:String(r.tripadvisor_id),o?(i.style.background="rgba(255, 255, 255, 0.5)",i.style.backdropFilter="blur(4px)",i.style.borderColor="transparent",i.style.cursor="default"):(i.style.background="#012b11",i.style.borderColor="#ffffff",i.style.color="#ffffff",i.style.cursor="pointer"),i.addEventListener("mouseenter",()=>{o||(i.style.transform="scale(1.2)")}),i.addEventListener("mouseleave",()=>{i.style.transform="scale(1)"}),!o&&((x=r.awards)!=null&&x.length||s)){let m=document.createElement("div");if(m.style.position="absolute",m.style.top="-12px",m.style.right="-20px",(g=r.awards)!=null&&g.length&&r.awards[0].type){let h=document.createElement("div");h.style.position="relative",h.style.width="32px",h.style.height="32px";let k=document.createElement("div");k.style.position="absolute",k.style.stroke="#f5f5f5",k.style.strokeWidth="2px",k.innerHTML=W;let c=document.createElement("div");c.style.position="absolute",c.style.top="6.2px",c.style.left="6.3px",c.style.width="18.5px",c.style.height="18.5px",c.style.borderRadius="50%",c.style.background=r.awards[0].type==="1"?"#00AA6C":"#FFC107",c.style.zIndex="1";let M=document.createElement("div");M.style.position="relative",M.style.zIndex="2",M.innerHTML=Z,h.appendChild(k),h.appendChild(c),h.appendChild(M),m.appendChild(h)}else s&&(m.style.display="flex",m.style.alignItems="center",m.style.justifyContent="center",m.style.borderRadius="999px",m.style.background="#00AA6C",m.style.color="#ffffff",m.style.fontSize="12px",m.style.lineHeight="1",m.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",m.style.padding="2px 6px",m.style.border="2px solid #ffffff",m.style.fontWeight="400",m.textContent=s);i.appendChild(m)}let d=document.createElement("span");return a?d.textContent=(y=(u=(p=r.pricing)==null?void 0:p.offer)==null?void 0:u.displayPrice)!=null?y:"\u2014":r.type==="Eat & Drink"?(d.innerHTML=K,d.style.display="flex",d.style.alignItems="center"):r.type==="Attraction"&&(d.innerHTML=$,d.style.display="flex",d.style.alignItems="center"),i.appendChild(d),i.addEventListener("click",m=>{m.stopPropagation(),o||e==null||e(r)}),l.appendChild(i),l}var L=class{constructor(e){this.markerCache=new Map;var r;this.mapInstance=e.mapInstance,this.MarkerCtor=(r=e.maplibregl)==null?void 0:r.Marker,this.onMarkerClick=e.onMarkerClick}render(e){if(!this.MarkerCtor)return;let r=new Set(e.map(a=>a.key));for(let[a,n]of this.markerCache.entries())if(!r.has(a)){try{n.marker.remove()}catch{}this.markerCache.delete(a)}for(let a of e){let n=U(a.marker.location);if(!n)continue;let o=this.markerCache.get(a.key);if(o)try{o.marker.setLngLat([n.lon,n.lat])}catch{try{o.marker.remove()}catch{}this.markerCache.delete(a.key),this.createAndAddMarker(a,n)}else this.createAndAddMarker(a,n)}}destroy(){for(let e of this.markerCache.values())try{e.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(e,r){if(!this.MarkerCtor)return;let a=e.kind==="primary"?P(e,this.onMarkerClick):C(e,this.onMarkerClick);if(a)try{let n=new this.MarkerCtor({element:a,anchor:e.kind==="primary"?"bottom":"center"}).setLngLat([r.lon,r.lat]).addTo(this.mapInstance);this.markerCache.set(e.key,{key:e.key,marker:n,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch{}}};function U(t){return typeof(t==null?void 0:t.lon)!="number"||typeof(t==null?void 0:t.lat)!="number"||Number.isNaN(t.lon)||Number.isNaN(t.lat)?null:{lon:t.lon,lat:t.lat}}var I=class{constructor(e){this.markerCache=new Map;this.mapInstance=e.mapInstance,this.google=e.google,this.onMarkerClick=e.onMarkerClick}render(e){var a,n;if(!((n=(a=this.google)==null?void 0:a.marker)!=null&&n.AdvancedMarkerElement)){console.warn("AdvancedMarkerElement not available");return}let r=new Set(e.map(o=>o.key));for(let[o,s]of this.markerCache.entries())if(!r.has(o)){try{s.marker.map=null}catch(l){console.error("Error removing marker",l)}this.markerCache.delete(o)}for(let o of e){let s=Y(o.marker.location);if(!s)continue;let l=this.markerCache.get(o.key);if(l)try{l.marker.position={lat:s.lat,lng:s.lon}}catch{try{l.marker.map=null}catch(i){console.error("Error removing marker",i)}this.markerCache.delete(o.key),this.createAndAddMarker(o,s)}else this.createAndAddMarker(o,s)}}destroy(){for(let e of this.markerCache.values())try{e.marker.map=null}catch(r){console.error("Error removing marker",r)}this.markerCache.clear()}createAndAddMarker(e,r){var n,o;if(!((o=(n=this.google)==null?void 0:n.marker)!=null&&o.AdvancedMarkerElement))return;let a=e.kind==="primary"?P(e,this.onMarkerClick):C(e,this.onMarkerClick);if(a)try{let s=new this.google.marker.AdvancedMarkerElement({map:this.mapInstance,position:{lat:r.lat,lng:r.lon},content:a,zIndex:e.kind==="primary"?20:10});this.markerCache.set(e.key,{key:e.key,marker:s,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch(s){console.error("Error creating marker",s)}}};function Y(t){return typeof(t==null?void 0:t.lon)!="number"||typeof(t==null?void 0:t.lat)!="number"||Number.isNaN(t.lon)||Number.isNaN(t.lat)?null:{lon:t.lon,lat:t.lat}}var w=class{constructor(e){this.markerCache=new Map;var r;this.mapInstance=e.mapInstance,this.MarkerCtor=(r=e.mapboxgl)==null?void 0:r.Marker,this.onMarkerClick=e.onMarkerClick}render(e){if(!this.MarkerCtor)return;let r=new Set(e.map(a=>a.key));for(let[a,n]of this.markerCache.entries())if(!r.has(a)){try{n.marker.remove()}catch{}this.markerCache.delete(a)}for(let a of e){let n=X(a.marker.location);if(!n)continue;let o=this.markerCache.get(a.key);if(o)try{o.marker.setLngLat([n.lon,n.lat])}catch{try{o.marker.remove()}catch{}this.markerCache.delete(a.key),this.createAndAddMarker(a,n)}else this.createAndAddMarker(a,n)}}destroy(){for(let e of this.markerCache.values())try{e.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(e,r){if(!this.MarkerCtor)return;let a=e.kind==="primary"?P(e,this.onMarkerClick):C(e,this.onMarkerClick);if(a)try{let n=new this.MarkerCtor({element:a,anchor:e.kind==="primary"?"bottom":"center"}).setLngLat([r.lon,r.lat]).addTo(this.mapInstance);this.markerCache.set(e.key,{key:e.key,marker:n,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch{}}};function X(t){return typeof(t==null?void 0:t.lon)!="number"||typeof(t==null?void 0:t.lat)!="number"||Number.isNaN(t.lon)||Number.isNaN(t.lat)?null:{lon:t.lon,lat:t.lat}}var b=class{constructor(e){this.map=e}getMap(){return this.map}};var E=class extends b{constructor(e){super(e)}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let e=this.map.getBounds(),r=e.getSouthWest(),a=e.getNorthEast();return{sw:{lat:r.lat,lng:r.lng},ne:{lat:a.lat,lng:a.lng}}}project(e){return this.map.project({lng:e[0],lat:e[1]})}on(e,r){this.map.on(e,r)}off(e,r){this.map.off(e,r)}resize(){this.map.resize()}remove(){this.map.remove()}};var N=class extends b{constructor(e){super(e),this.initializeOverlayView()}initializeOverlayView(){var a;let e=(a=globalThis.google)==null?void 0:a.maps;if(!e)return;let r=e.OverlayView;r&&(this.overlayView=new r,this.overlayView.draw=function(){},this.overlayView.setMap(this.map))}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return e?{lng:e.lng(),lat:e.lat()}:{lng:0,lat:0}}getZoom(){var e;return(e=this.map.getZoom())!=null?e:0}getBearing(){var e;return(e=this.map.getHeading())!=null?e:0}getPitch(){var e;return(e=this.map.getTilt())!=null?e:0}getMapBounds(){let e=this.map.getBounds();if(!e)return{sw:{lat:0,lng:0},ne:{lat:0,lng:0}};let r=e.getSouthWest(),a=e.getNorthEast();return{sw:{lat:r.lat(),lng:r.lng()},ne:{lat:a.lat(),lng:a.lng()}}}project(e){var s;if(!this.overlayView)return{x:0,y:0};let r=this.overlayView.getProjection();if(!r)return{x:0,y:0};let a=(s=globalThis.google)==null?void 0:s.maps;if(!a)return{x:0,y:0};let n=new a.LatLng(e[1],e[0]),o=r.fromLatLngToContainerPixel(n);return o?{x:o.x,y:o.y}:{x:0,y:0}}on(e,r){this.map.addListener(e,r)}off(e,r){var n;let a=(n=globalThis.google)==null?void 0:n.maps;a!=null&&a.event&&a.event.clearListeners(this.map,e)}resize(){var r;let e=(r=globalThis.google)==null?void 0:r.maps;e!=null&&e.event&&e.event.trigger(this.map,"resize")}remove(){this.overlayView&&(this.overlayView.setMap(null),this.overlayView=null)}};var O=class extends b{constructor(e){super(e)}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let e=this.map.getBounds(),r=e.getSouthWest(),a=e.getNorthEast();return{sw:{lat:r.lat,lng:r.lng},ne:{lat:a.lat,lng:a.lng}}}project(e){return this.map.project({lng:e[0],lat:e[1]})}on(e,r){this.map.on(e,r)}off(e,r){this.map.off(e,r)}resize(){this.map.resize()}remove(){this.map.remove()}};var q="Accommodation",S=class{constructor(e){this.options=e;this.cleanupFns=[];this.markers=[];this.selectedMarkerId=null;this.destroyed=!1;this.clusterItems=[];var r,a,n,o,s;if(this.markers=[...(r=e.markers)!=null?r:[]],this.primaryType=e.primaryType,this.selectedMarkerId=(a=e.selectedMarkerId)!=null?a:null,J(e)){let l=(n=e.autoSelectOnClick)!=null?n:!0;this.adapter=new E(e.mapInstance),this.markerRenderer=new L({mapInstance:e.mapInstance,maplibregl:e.maplibregl,onMarkerClick:i=>{var d;l&&this.setSelectedMarker(i.tripadvisor_id),(d=e.onMarkerClick)==null||d.call(e,i)}}),this.attachMapLibreListeners(e.mapInstance)}else if(Q(e)){let l=(o=e.autoSelectOnClick)!=null?o:!0;this.adapter=new N(e.mapInstance),this.markerRenderer=new I({mapInstance:e.mapInstance,google:e.google,onMarkerClick:i=>{var d;l&&this.setSelectedMarker(i.tripadvisor_id),(d=e.onMarkerClick)==null||d.call(e,i)}}),this.attachGoogleMapsListeners(e.mapInstance)}else if(ee(e)){let l=(s=e.autoSelectOnClick)!=null?s:!0;this.adapter=new O(e.mapInstance),this.markerRenderer=new w({mapInstance:e.mapInstance,mapboxgl:e.mapboxgl,onMarkerClick:i=>{var d;l&&this.setSelectedMarker(i.tripadvisor_id),(d=e.onMarkerClick)==null||d.call(e,i)}}),this.attachMapboxListeners(e.mapInstance)}else this.adapter=e.adapter;this.refresh()}setMarkers(e){this.ensureAlive(),this.markers=[...e],this.refresh()}addMarker(e){this.ensureAlive(),this.markers=[...this.markers,e],this.refresh()}clearMarkers(){this.ensureAlive(),this.markers=[],this.refresh()}setPrimaryType(e){this.ensureAlive(),this.primaryType!==e&&(this.primaryType=e,this.refresh())}setSelectedMarker(e){this.ensureAlive(),this.selectedMarkerId!==e&&(this.selectedMarkerId=e,this.refresh())}getClusters(){return this.ensureAlive(),[...this.clusterItems]}refresh(){var o,s,l,i;this.ensureAlive();let e=this.safeExtractViewState(),r=this.resolvePrimaryType(),{collisionPx:a,dotPx:n}=this.resolveCollisionOverrides(e);this.clusterItems=B({primaryType:r,markers:this.markers,map:this.adapter,selectedMarkerId:this.selectedMarkerId,zoom:(o=e==null?void 0:e.zoom)!=null?o:0,collisionThresholdPx:a,dotCollisionThresholdPx:n}),(s=this.markerRenderer)==null||s.render(this.clusterItems),(i=(l=this.options).onClusterUpdate)==null||i.call(l,this.clusterItems,e)}destroy(){var e;if(!this.destroyed){(e=this.markerRenderer)==null||e.destroy();for(let r of this.cleanupFns)try{r()}catch{}this.cleanupFns.length=0,this.clusterItems=[],this.markers=[],this.destroyed=!0}}resolvePrimaryType(){var e,r,a;return(a=(r=this.primaryType)!=null?r:(e=this.markers.find(n=>n.type))==null?void 0:e.type)!=null?a:q}safeExtractViewState(){try{return re(this.adapter)}catch{return null}}resolveCollisionOverrides(e){if(!e)return{collisionPx:void 0,dotPx:void 0};let r=this.options.clusterRadiusMeters;if(!r||!Number.isFinite(r)||r<=0)return{collisionPx:void 0,dotPx:void 0};let a=oe(r,e.latitude,e.zoom);if(!Number.isFinite(a)||a<=0)return{collisionPx:void 0,dotPx:void 0};let n=Math.max(32,Math.round(a)),o=Math.max(48,n);return{collisionPx:n,dotPx:o}}attachMapLibreListeners(e){if(!e||typeof e.on!="function")return;let r=()=>this.refresh();["move","zoom","dragend","pitch","rotate"].forEach(n=>{e.on(n,r),this.cleanupFns.push(()=>{typeof e.off=="function"&&e.off(n,r)})})}attachGoogleMapsListeners(e){let r=()=>this.refresh(),a=["center_changed","zoom_changed","drag","heading_changed","tilt_changed"],n=[];a.forEach(o=>{let s=e.addListener(o,r);n.push(s)}),this.cleanupFns.push(()=>{n.forEach(o=>{try{o.remove()}catch{}})})}attachMapboxListeners(e){if(!e||typeof e.on!="function")return;let r=()=>this.refresh();["move","zoom","dragend","pitch","rotate"].forEach(n=>{e.on(n,r),this.cleanupFns.push(()=>{typeof e.off=="function"&&e.off(n,r)})})}ensureAlive(){if(this.destroyed)throw new Error("MapFirstCore instance has been destroyed")}};function J(t){return t.platform==="maplibre"}function Q(t){return t.platform==="google"}function ee(t){return t.platform==="mapbox"}function re(t){let e=t.getCenter();return{longitude:e.lng,latitude:e.lat,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}}var te=[{zoom:6,threshold:120},{zoom:8,threshold:108},{zoom:10,threshold:92},{zoom:12,threshold:80},{zoom:14,threshold:68},{zoom:16,threshold:56}];function z(t){for(let e of te)if(t<=e.zoom)return e.threshold;return 48}function B({primaryType:t,markers:e,map:r,selectedMarkerId:a,zoom:n,collisionThresholdPx:o,dotCollisionThresholdPx:s}){if(!e.length)return[];if(!r)return e.map(p=>({kind:"primary",marker:p,key:`primary-${p.tripadvisor_id}`}));let l=e.map((p,u)=>{let y=p.location;if(typeof(y==null?void 0:y.lon)!="number"||typeof(y==null?void 0:y.lat)!="number")return null;let{x:m,y:h}=r.project([y.lon,y.lat]);return{marker:p,index:u,x:m,y:h}}).filter(p=>!!p);if(!l.length)return[];let i=z(n),d=ne(n),f=l.map((p,u)=>u),v=p=>f[p]===p?p:(f[p]=v(f[p]),f[p]),A=(p,u)=>{let y=v(p),m=v(u);y!==m&&(f[m]=y)};for(let p=0;p<l.length;p+=1)for(let u=p+1;u<l.length;u+=1){let y=l[p].x-l[u].x,m=l[p].y-l[u].y;Math.hypot(y,m)<=i&&A(p,u)}let x=new Map;for(let p of l){let u=v(p.index),y=x.get(u);y?y.push(p):x.set(u,[p])}let g=[];return x.forEach(p=>{if(p.length===1){let[{marker:c}]=p;g.push({kind:"primary",marker:c,key:`primary-${c.tripadvisor_id}`});return}let u=[...p].sort((c,M)=>se(M.marker,c.marker,t)),[y,...m]=u;if(g.push({kind:"primary",marker:y.marker,key:`primary-${y.marker.tripadvisor_id}`}),!m.length)return;let h=[],k=[];if(m.forEach(c=>{if(a&&c.marker.tripadvisor_id===a){g.push({kind:"primary",marker:c.marker,key:`primary-${c.marker.tripadvisor_id}`});return}ae(y,c)<=d?h.push(c):k.push(c)}),h.forEach(c=>{g.push({kind:"dot",marker:c.marker,key:`dot-${c.marker.tripadvisor_id}`,parentId:y.marker.tripadvisor_id})}),k.length){let c=B({markers:k.map(M=>M.marker),map:r,selectedMarkerId:a,zoom:n,primaryType:t,collisionThresholdPx:o,dotCollisionThresholdPx:s});g.push(...c)}}),g}function ae(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}function ne(t){let e=z(t);return Math.max(48,e)}function se(t,e,r){var i,d;let a=t.type===r,n=e.type===r;if(a&&!n)return 1;if(!a&&n)return-1;let o=H(t)-H(e);if(o!==0)return o;let s=D(t)-D(e);if(s!==0)return s;let l=((i=t.reviews)!=null?i:0)-((d=e.reviews)!=null?d:0);return l!==0?l:t.tripadvisor_id-e.tripadvisor_id}function H(t){if(typeof t.rating=="number")return t.rating;if(t.rating===void 0||t.rating===null)return-1/0;let e=Number(t.rating);return Number.isNaN(e)?-1/0:e}function D(t){var r,a,n;if(!((a=(r=t.pricing)==null?void 0:r.offer)!=null&&a.price))return-1/0;let e=Number(((n=t.pricing.offer.displayPrice)!=null?n:"0").replace(/[^0-9.,-]+/g,"").replace(/,/g,""));return Number.isNaN(e)?-1/0:e}function oe(t,e,r){let a=Math.cos(e*Math.PI/180)*2*Math.PI*6378137/(256*2**r);return!Number.isFinite(a)||a<=0?t:t/a}0&&(module.exports={MapFirstCore});
//# sourceMappingURL=index.js.map