"use strict";var H=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var ne=(i,e)=>{for(var r in e)H(i,r,{get:e[r],enumerable:!0})},se=(i,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of ae(e))!ie.call(i,t)&&t!==r&&H(i,t,{get:()=>e[t],enumerable:!(a=te(e,t))||a.enumerable});return i};var oe=i=>se(H({},"__esModule",{value:!0}),i);var xe={};ne(xe,{MapFirstCore:()=>G,PropertiesFetchError:()=>D,fetchProperties:()=>ee});module.exports=oe(xe);function j(i,{insertAt:e}={}){if(!i||typeof document=="undefined")return;let r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",e==="top"&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=i:a.appendChild(document.createTextNode(i))}j(`.mapfirst-marker-root{display:flex;z-index:20;flex-direction:column;align-items:center;pointer-events:auto}.mapfirst-marker-pill{border:2px solid;border-radius:999px;padding:8px;font-size:16px;font-weight:600;font-family:system-ui,-apple-system,sans-serif;box-shadow:0 4px 6px #6b728080;display:flex;align-items:center;justify-content:center;position:relative;transition:transform .2s;transform-origin:center bottom}.mapfirst-marker-pill-pending{background:#ffffff80;backdrop-filter:blur(4px);border-color:transparent;cursor:default}.mapfirst-marker-pill-active{background:#012b11;border-color:#fff;color:#fff;cursor:pointer}.mapfirst-marker-pill-active.mapfirst-marker-non-primary{background:#ffffffb3;border-color:#03852e80;color:#03852e80;padding:4px}.mapfirst-marker-pill-active.mapfirst-marker-selected{background:#fff;border-color:#03852e;color:#03852e;transform:scale(1.2)}.mapfirst-marker-pill-active:hover{transform:scale(1.2)}.mapfirst-marker-badge{position:absolute;top:-12px;right:-20px}.mapfirst-marker-award-container{position:relative;width:32px;height:32px}.mapfirst-marker-award-back{position:absolute;stroke:#f5f5f5;stroke-width:2px}.mapfirst-marker-award-dot{position:absolute;top:6.2px;left:6.3px;width:18.5px;height:18.5px;border-radius:50%;z-index:1}.mapfirst-marker-award-dot-type-0{background:#ffef0e}.mapfirst-marker-award-dot-type-1{background:#01ea5b}.mapfirst-marker-award-front{position:relative;z-index:2;color:#012b11}.mapfirst-marker-rating-badge{display:flex;align-items:center;justify-content:center;border-radius:999px;background:#03852e;color:#fff;font-size:12px;line-height:1;box-shadow:0 2px 4px #0003;padding:2px 6px;border:2px solid #ffffff;font-weight:400}.mapfirst-marker-content{display:flex;align-items:center}.mapfirst-dot-marker-container{display:flex;z-index:10;align-items:center;justify-content:center;pointer-events:auto}.mapfirst-dot-marker-button{width:20px;height:20px;border-radius:999px;border:2px solid #ffffff;box-shadow:0 2px 4px #6b728066;transition:transform .2s;outline:none;transform-origin:center center}.mapfirst-dot-marker-button-pending{background:#d1d5db;cursor:default}.mapfirst-dot-marker-button-active{background:#012b11;cursor:pointer}.mapfirst-dot-marker-button-active.mapfirst-dot-marker-non-primary{background:#ffffffb3;border-color:#03852e33}.mapfirst-dot-marker-button-active.mapfirst-dot-marker-selected{background:#fff;border-color:#03852e}.mapfirst-dot-marker-button-active:hover{transform:scale(1.2)}.mapfirst-dot-marker-button-active:focus{outline:2px solid #ffffff;outline-offset:2px}
`);function A(i,e,r,a){var d,l,h;if(typeof document=="undefined")return null;let t=i.marker,n=t.type===e,c=r===t.tripadvisor_id,f=t.type==="Accommodation"&&((l=(d=t.pricing)==null?void 0:d.offer)==null?void 0:l.availability)!=="available",o=document.createElement("div");o.className="mapfirst-dot-marker-container",o.style.zIndex=c?"20":n?"3":"1";let p=document.createElement("button");return p.type="button",p.className=f?"mapfirst-dot-marker-button mapfirst-dot-marker-button-pending":`mapfirst-dot-marker-button mapfirst-dot-marker-button-active${c?" mapfirst-dot-marker-selected":n?"":" mapfirst-dot-marker-non-primary"}`,p.title=(h=t.name)!=null?h:String(t.tripadvisor_id),p.addEventListener("click",k=>{k.stopPropagation(),f||a==null||a(t)}),o.appendChild(p),o}var pe='<svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M12 3.953a7.442 7.442 0 1 0 .001 14.884A7.442 7.442 0 0 0 12 3.953m0 14.05a6.61 6.61 0 1 1 0-13.218 6.61 6.61 0 0 1 0 13.219M10.343 11.9a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.821 0m5.134 0a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.82 0m.82-1.897.84-.913h-1.863A5.8 5.8 0 0 0 12 8.08a5.77 5.77 0 0 0-3.27 1.008H6.862l.84.913a2.567 2.567 0 1 0 3.475 3.78l.823.896.823-.895a2.568 2.568 0 1 0 3.474-3.78m-6.865 3.634a1.738 1.738 0 1 1 0-3.476 1.738 1.738 0 0 1 0 3.476M12 11.85c0-1.143-.832-2.124-1.929-2.543A5 5 0 0 1 12 8.92a5 5 0 0 1 1.928.386c-1.096.42-1.927 1.4-1.927 2.543m2.566 1.787a1.738 1.738 0 1 1 .001-3.476 1.738 1.738 0 0 1 0 3.476m-8.456 3.719s-.377-.946-1.396-1.903c-1.02-.957-2.303-1.132-2.303-1.132s.457 1.02 1.54 2.04c1.086 1.017 2.159.995 2.159.995m2.568 1.41s-.524-.511-1.479-.883-1.861-.191-1.861-.191.598.54 1.615.935c1.016.397 1.725.139 1.725.139m2.493.505s-.545-.224-1.357-.196-1.415.47-1.415.47.608.222 1.473.193 1.3-.467 1.3-.467m-6.186-4.203s-.175-1.008-.974-2.154c-.8-1.147-2.015-1.578-2.015-1.578s.238 1.098 1.089 2.319c.85 1.22 1.9 1.413 1.9 1.413m-1.003-3.071s.195-1.021-.134-2.393c-.328-1.371-1.294-2.21-1.294-2.21s-.17 1.128.18 2.589c.35 1.46 1.248 2.014 1.248 2.014"></path><path d="M17.887 17.355s.377-.946 1.396-1.903c1.02-.957 2.303-1.132 2.303-1.132s-.457 1.02-1.54 2.04c-1.086 1.017-2.159.995-2.159.995m-2.567 1.41s.524-.511 1.479-.883 1.861-.191 1.861-.191-.598.54-1.615.935c-1.016.397-1.725.139-1.725.139m-2.493.505s.545-.224 1.357-.196 1.415.47 1.415.47-.608.222-1.473.193-1.3-.467-1.3-.467m6.186-4.203s.175-1.008.974-2.154c.8-1.147 2.015-1.578 2.015-1.578s-.238 1.098-1.089 2.319c-.85 1.22-1.9 1.413-1.9 1.413m1.003-3.071s-.195-1.021.133-2.393c.33-1.371 1.293-2.21 1.293-2.21s.17 1.128-.18 2.589c-.349 1.46-1.246 2.014-1.246 2.014M12 20.047a.413.413 0 1 0 0-.827.413.413 0 0 0 0 .827"></path></svg>',le='<svg viewBox="0 0 24 24" width="32" height="32"><path d="M12 3.953a7.442 7.442 0 1 0 .001 14.884A7.442 7.442 0 0 0 12 3.953m0 14.05a6.61 6.61 0 1 1 0-13.218 6.61 6.61 0 0 1 0 13.219M10.343 11.9a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.821 0m5.134 0a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.82 0m.82-1.897.84-.913h-1.863A5.8 5.8 0 0 0 12 8.08a5.77 5.77 0 0 0-3.27 1.008H6.862l.84.913a2.567 2.567 0 1 0 3.475 3.78l.823.896.823-.895a2.568 2.568 0 1 0 3.474-3.78m-6.865 3.634a1.738 1.738 0 1 1 0-3.476 1.738 1.738 0 0 1 0 3.476M12 11.85c0-1.143-.832-2.124-1.929-2.543A5 5 0 0 1 12 8.92a5 5 0 0 1 1.928.386c-1.096.42-1.927 1.4-1.927 2.543m2.566 1.787a1.738 1.738 0 1 1 .001-3.476 1.738 1.738 0 0 1 0 3.476m-8.456 3.719s-.377-.946-1.396-1.903c-1.02-.957-2.303-1.132-2.303-1.132s.457 1.02 1.54 2.04c1.086 1.017 2.159.995 2.159.995m2.568 1.41s-.524-.511-1.479-.883-1.861-.191-1.861-.191.598.54 1.615.935c1.016.397 1.725.139 1.725.139m2.493.505s-.545-.224-1.357-.196-1.415.47-1.415.47.608.222 1.473.193 1.3-.467 1.3-.467m-6.186-4.203s-.175-1.008-.974-2.154c-.8-1.147-2.015-1.578-2.015-1.578s.238 1.098 1.089 2.319c.85 1.22 1.9 1.413 1.9 1.413m-1.003-3.071s.195-1.021-.134-2.393c-.328-1.371-1.294-2.21-1.294-2.21s-.17 1.128.18 2.589c.35 1.46 1.248 2.014 1.248 2.014"></path><path d="M17.887 17.355s.377-.946 1.396-1.903c1.02-.957 2.303-1.132 2.303-1.132s-.457 1.02-1.54 2.04c-1.086 1.017-2.159.995-2.159.995m-2.567 1.41s.524-.511 1.479-.883 1.861-.191 1.861-.191-.598.54-1.615.935c-1.016.397-1.725.139-1.725.139m-2.493.505s.545-.224 1.357-.196 1.415.47 1.415.47-.608.222-1.473.193-1.3-.467-1.3-.467m6.186-4.203s.175-1.008.974-2.154c.8-1.147 2.015-1.578 2.015-1.578s-.238 1.098-1.089 2.319c-.85 1.22-1.9 1.413-1.9 1.413m1.003-3.071s-.195-1.021.133-2.393c.33-1.371 1.293-2.21 1.293-2.21s.17 1.128-.18 2.589c-.349 1.46-1.246 2.014-1.246 2.014M12 20.047a.413.413 0 1 0 0-.827.413.413 0 0 0 0 .827"></path></svg>',me='<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.051 6.549v.003l1.134 1.14 3.241-3.25.003-.002 1.134 1.136-3.243 3.252 1.134 1.14a1 1 0 0 0 .09-.008c.293-.05.573-.324.72-.474l.005-.006 2.596-2.603L22 8.016l-2.597 2.604a3.73 3.73 0 0 1-1.982 1.015 4.3 4.3 0 0 1-3.162-.657l-.023-.016-.026-.018-1.366 1.407 8.509 8.512L20.219 22l-.002-.002-6.654-6.663-2.597 2.76-7.3-7.315C1.967 8.948 1.531 6.274 2.524 4.198c.241-.504.566-.973.978-1.386l8.154 8.416 1.418-1.423-.039-.045c-.858-1.002-1.048-2.368-.62-3.595a4.15 4.15 0 0 1 .983-1.561L16 2l1.135 1.138-2.598 2.602-.047.045c-.16.151-.394.374-.433.678zM3.809 5.523c-.362 1.319-.037 2.905 1.06 4.103L10.93 15.7l1.408-1.496zM2.205 20.697 3.34 21.84l4.543-4.552-1.135-1.143z"/></svg>',ce='<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.56 7.5H3.75a.25.25 0 0 0-.25.25v10c0 .138.112.25.25.25h16.5a.25.25 0 0 0 .25-.25v-10a.25.25 0 0 0-.25-.25h-3.81l-2-2H9.56zM8.94 4h6.12l2 2h3.19c.966 0 1.75.784 1.75 1.75v10a1.75 1.75 0 0 1-1.75 1.75H3.75A1.75 1.75 0 0 1 2 17.75v-10C2 6.784 2.784 6 3.75 6h3.19z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12 9.25a2.75 2.75 0 1 0 0 5.5 2.75 2.75 0 0 0 0-5.5M7.75 12a4.25 4.25 0 1 1 8.5 0 4.25 4.25 0 0 1-8.5 0"/></svg>';function w(i,e,r,a){var k,m,y,s,g,v,C,x;if(typeof document=="undefined")return null;let t=i.marker,n=t.type===e,c=r===t.tripadvisor_id,u=t.type==="Accommodation",f=(m=(k=t.pricing)==null?void 0:k.offer)==null?void 0:m.displayPrice,o=u&&!f,p=(()=>{if(t.rating===void 0||t.rating===null)return null;let b=typeof t.rating=="number"?t.rating:Number(t.rating);return Number.isNaN(b)||b<=0?null:b.toFixed(1)})(),d=document.createElement("div");d.className="mapfirst-marker-root",d.style.zIndex=c?"20":n?"12":"11";let l=document.createElement("button");if(l.type="button",l.className=o?"mapfirst-marker-pill mapfirst-marker-pill-pending":`mapfirst-marker-pill mapfirst-marker-pill-active${c?" mapfirst-marker-selected":n?"":" mapfirst-marker-non-primary"}`,l.title=(y=t.name)!=null?y:String(t.tripadvisor_id),!o&&((s=t.awards)!=null&&s.length||p)){let b=document.createElement("div");if(b.className="mapfirst-marker-badge",n||(b.style.opacity="0.2"),b.className="mapfirst-marker-badge",(g=t.awards)!=null&&g.length&&t.awards[0].type){let M=document.createElement("div");M.className="mapfirst-marker-award-container";let P=document.createElement("div");P.className="mapfirst-marker-award-back",P.innerHTML=le;let L=document.createElement("div");L.className=`mapfirst-marker-award-dot mapfirst-marker-award-dot-type-${t.awards[0].type}`;let T=document.createElement("div");T.className="mapfirst-marker-award-front",T.innerHTML=pe,M.appendChild(P),M.appendChild(L),M.appendChild(T),b.appendChild(M)}else p&&(b.className="mapfirst-marker-badge mapfirst-marker-rating-badge",b.textContent=p);l.appendChild(b)}let h=document.createElement("span");return h.className="mapfirst-marker-content",u?h.textContent=(x=(C=(v=t.pricing)==null?void 0:v.offer)==null?void 0:C.displayPrice)!=null?x:"\u2014":t.type==="Eat & Drink"?h.innerHTML=me:t.type==="Attraction"&&(h.innerHTML=ce),l.appendChild(h),l.addEventListener("click",b=>{b.stopPropagation(),o||a==null||a(t)}),d.appendChild(l),d}function E(i,e,r,a){let t=i;t.style.zIndex=r?"20":e?"12":"11";let n=t.querySelector(".mapfirst-marker-pill");n&&(a?n.className="mapfirst-marker-pill mapfirst-marker-pill-pending":n.className=`mapfirst-marker-pill mapfirst-marker-pill-active${r?" mapfirst-marker-selected":e?"":" mapfirst-marker-non-primary"}`);let c=t.querySelector(".mapfirst-marker-badge");c instanceof HTMLElement&&(c.style.opacity=!e&&!r?"0.2":"")}function S(i,e,r,a){let t=i;t.style.zIndex=r?"20":e?"3":"1";let n=t.querySelector(".mapfirst-dot-marker-button");n&&(a?n.className="mapfirst-dot-marker-button mapfirst-dot-marker-button-pending":n.className=`mapfirst-dot-marker-button mapfirst-dot-marker-button-active${r?" mapfirst-dot-marker-selected":e?"":" mapfirst-dot-marker-non-primary"}`)}function N(i){let e=i.match(/^(?:primary|dot)-(\d+)-/);return e?parseInt(e[1],10):null}var B=class{constructor(e){this.markerCache=new Map;this.primaryType="Accommodation";this.selectedMarkerId=null;var r;this.mapInstance=e.mapInstance,this.MarkerCtor=(r=e.maplibregl)==null?void 0:r.Marker,this.onMarkerClick=e.onMarkerClick}render(e,r,a){var n,c,u,f;if(r&&r!==this.primaryType&&(this.primaryType=r),a!==void 0&&(this.selectedMarkerId=a),!this.MarkerCtor)return;let t=new Set(e.map(o=>o.key));for(let[o,p]of this.markerCache.entries())if(!t.has(o)){try{p.marker.remove()}catch{}this.markerCache.delete(o)}for(let o of e){let p=de(o.marker.location);if(!p)continue;let d=this.markerCache.get(o.key);if(d)try{d.marker.setLngLat([p.lon,p.lat])}catch{try{d.marker.remove()}catch{}this.markerCache.delete(o.key),this.createAndAddMarker(o,p)}else{let l=o.marker.tripadvisor_id,h,k;for(let[m,y]of this.markerCache.entries())if(N(m)===l&&y.kind===o.kind){h=y,k=m;break}if(h&&k){let m=o.marker.type===this.primaryType,y=this.selectedMarkerId===o.marker.tripadvisor_id,s=o.marker.type==="Accommodation",g=o.kind==="primary"?s&&!((c=(n=o.marker.pricing)==null?void 0:n.offer)!=null&&c.displayPrice):s&&((f=(u=o.marker.pricing)==null?void 0:u.offer)==null?void 0:f.availability)!=="available",v=h.marker.getElement();v&&(o.kind==="primary"?E(v,m,y,g):S(v,m,y,g)),this.markerCache.delete(k),this.markerCache.set(o.key,h);try{h.marker.setLngLat([p.lon,p.lat])}catch{}}else this.createAndAddMarker(o,p)}}}destroy(){for(let e of this.markerCache.values())try{e.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(e,r){if(!this.MarkerCtor)return;let a=e.kind==="primary"?w(e,this.primaryType,this.selectedMarkerId,this.onMarkerClick):A(e,this.primaryType,this.selectedMarkerId,this.onMarkerClick);if(a)try{let t=new this.MarkerCtor({element:a,anchor:e.kind==="primary"?"bottom":"center"}).setLngLat([r.lon,r.lat]).addTo(this.mapInstance);this.markerCache.set(e.key,{key:e.key,marker:t,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch{}}};function de(i){return typeof(i==null?void 0:i.lon)!="number"||typeof(i==null?void 0:i.lat)!="number"||Number.isNaN(i.lon)||Number.isNaN(i.lat)?null:{lon:i.lon,lat:i.lat}}var O=class{constructor(e){this.markerCache=new Map;this.primaryType="Accommodation";this.selectedMarkerId=null;this.mapInstance=e.mapInstance,this.google=e.google,this.onMarkerClick=e.onMarkerClick}render(e,r,a){var n,c,u,f,o,p;if(r&&r!==this.primaryType&&(this.primaryType=r),a!==void 0&&(this.selectedMarkerId=a),!((c=(n=this.google)==null?void 0:n.marker)!=null&&c.AdvancedMarkerElement)){console.warn("AdvancedMarkerElement not available");return}let t=new Set(e.map(d=>d.key));for(let[d,l]of this.markerCache.entries())if(!t.has(d)){try{l.marker.map=null}catch(h){console.error("Error removing marker",h)}this.markerCache.delete(d)}for(let d of e){let l=ue(d.marker.location);if(!l)continue;let h=this.markerCache.get(d.key);if(h)try{h.marker.position={lat:l.lat,lng:l.lon}}catch{try{h.marker.map=null}catch(k){console.error("Error removing marker",k)}this.markerCache.delete(d.key),this.createAndAddMarker(d,l)}else{let k=d.marker.tripadvisor_id,m,y;for(let[s,g]of this.markerCache.entries())if(N(s)===k&&g.kind===d.kind){m=g,y=s;break}if(m&&y){let s=d.marker.type===this.primaryType,g=this.selectedMarkerId===d.marker.tripadvisor_id,v=d.marker.type==="Accommodation",C=d.kind==="primary"?v&&!((f=(u=d.marker.pricing)==null?void 0:u.offer)!=null&&f.displayPrice):v&&((p=(o=d.marker.pricing)==null?void 0:o.offer)==null?void 0:p.availability)!=="available",x=m.marker.content;x instanceof HTMLElement&&(d.kind==="primary"?E(x,s,g,C):S(x,s,g,C));let b=d.kind==="primary"?g?20:s?12:11:g?20:s?3:1;m.marker.zIndex=b,this.markerCache.delete(y),this.markerCache.set(d.key,m);try{m.marker.position={lat:l.lat,lng:l.lon}}catch{}}else this.createAndAddMarker(d,l)}}}destroy(){for(let e of this.markerCache.values())try{e.marker.map=null}catch(r){console.error("Error removing marker",r)}this.markerCache.clear()}createAndAddMarker(e,r){var u,f;if(!((f=(u=this.google)==null?void 0:u.marker)!=null&&f.AdvancedMarkerElement))return;let a=e.kind==="primary"?w(e,this.primaryType,this.selectedMarkerId,this.onMarkerClick):A(e,this.primaryType,this.selectedMarkerId,this.onMarkerClick);if(!a)return;let t=e.marker.type===this.primaryType,n=this.selectedMarkerId===e.marker.tripadvisor_id,c=e.kind==="primary"?n?20:t?12:11:n?20:t?3:1;try{let o=new this.google.marker.AdvancedMarkerElement({map:this.mapInstance,position:{lat:r.lat,lng:r.lon},content:a,zIndex:c});this.markerCache.set(e.key,{key:e.key,marker:o,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch(o){console.error("Error creating marker",o)}}};function ue(i){return typeof(i==null?void 0:i.lon)!="number"||typeof(i==null?void 0:i.lat)!="number"||Number.isNaN(i.lon)||Number.isNaN(i.lat)?null:{lon:i.lon,lat:i.lat}}var _=class{constructor(e){this.markerCache=new Map;this.primaryType="Accommodation";this.selectedMarkerId=null;var r;this.mapInstance=e.mapInstance,this.MarkerCtor=(r=e.mapboxgl)==null?void 0:r.Marker,this.onMarkerClick=e.onMarkerClick}render(e,r,a){var n,c,u,f;if(r&&r!==this.primaryType&&(this.primaryType=r),a!==void 0&&(this.selectedMarkerId=a),!this.MarkerCtor)return;let t=new Set(e.map(o=>o.key));for(let[o,p]of this.markerCache.entries())if(!t.has(o)){try{p.marker.remove()}catch{}this.markerCache.delete(o)}for(let o of e){let p=fe(o.marker.location);if(!p)continue;let d=this.markerCache.get(o.key);if(d)try{d.marker.setLngLat([p.lon,p.lat])}catch{try{d.marker.remove()}catch{}this.markerCache.delete(o.key),this.createAndAddMarker(o,p)}else{let l=o.marker.tripadvisor_id,h,k;for(let[m,y]of this.markerCache.entries())if(N(m)===l&&y.kind===o.kind){h=y,k=m;break}if(h&&k){let m=o.marker.type===this.primaryType,y=this.selectedMarkerId===o.marker.tripadvisor_id,s=o.marker.type==="Accommodation",g=o.kind==="primary"?s&&!((c=(n=o.marker.pricing)==null?void 0:n.offer)!=null&&c.displayPrice):s&&((f=(u=o.marker.pricing)==null?void 0:u.offer)==null?void 0:f.availability)!=="available",v=h.marker.getElement();v&&(o.kind==="primary"?E(v,m,y,g):S(v,m,y,g)),this.markerCache.delete(k),this.markerCache.set(o.key,h);try{h.marker.setLngLat([p.lon,p.lat])}catch{}}else this.createAndAddMarker(o,p)}}}destroy(){for(let e of this.markerCache.values())try{e.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(e,r){if(!this.MarkerCtor)return;let a=e.kind==="primary"?w(e,this.primaryType,this.selectedMarkerId,this.onMarkerClick):A(e,this.primaryType,this.selectedMarkerId,this.onMarkerClick);if(a)try{let t=new this.MarkerCtor({element:a,anchor:e.kind==="primary"?"bottom":"center"}).setLngLat([r.lon,r.lat]).addTo(this.mapInstance);this.markerCache.set(e.key,{key:e.key,marker:t,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch{}}};function fe(i){return typeof(i==null?void 0:i.lon)!="number"||typeof(i==null?void 0:i.lat)!="number"||Number.isNaN(i.lon)||Number.isNaN(i.lat)?null:{lon:i.lon,lat:i.lat}}var I=class{constructor(e){this.map=e}getMap(){return this.map}};var F=class extends I{constructor(r){super(r);this.cleanupFns=[]}initialize(r){return this.markerManager=new B({mapInstance:this.map,maplibregl:r.maplibregl,onMarkerClick:r.onMarkerClick}),r.onRefresh&&this.attachEventListeners(r.onRefresh),this.markerManager}attachEventListeners(r){if(!this.map||typeof this.map.on!="function")return;["move","zoom","dragend","pitch","rotate"].forEach(t=>{this.map.on(t,r),this.cleanupFns.push(()=>{typeof this.map.off=="function"&&this.map.off(t,r)})})}getMarkerManager(){return this.markerManager}cleanup(){for(let r of this.cleanupFns)try{r()}catch{}this.cleanupFns.length=0}getMap(){return this.map}getCenter(){let r=this.map.getCenter();return{lng:r.lng,lat:r.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let r=this.map.getBounds(),a=r.getSouthWest(),t=r.getNorthEast();return{sw:{lat:a.lat,lng:a.lng},ne:{lat:t.lat,lng:t.lng}}}project(r){return this.map.project({lng:r[0],lat:r[1]})}on(r,a){this.map.on(r,a)}off(r,a){this.map.off(r,a)}resize(){this.map.resize()}remove(){this.cleanup(),this.map.remove()}};var z=class extends I{constructor(r){super(r);this.cleanupFns=[];this.initializeOverlayView()}initialize(r){return this.markerManager=new O({mapInstance:this.map,google:r.google,onMarkerClick:r.onMarkerClick}),r.onRefresh&&this.attachEventListeners(r.onRefresh),this.markerManager}attachEventListeners(r){let a=["center_changed","zoom_changed","drag","heading_changed","tilt_changed"],t=[];a.forEach(n=>{let c=this.map.addListener(n,r);t.push(c)}),this.cleanupFns.push(()=>{t.forEach(n=>{try{n.remove()}catch{}})})}getMarkerManager(){return this.markerManager}cleanup(){for(let r of this.cleanupFns)try{r()}catch{}this.cleanupFns.length=0}initializeOverlayView(){var t;let r=(t=globalThis.google)==null?void 0:t.maps;if(!r)return;let a=r.OverlayView;a&&(this.overlayView=new a,this.overlayView.draw=function(){},this.overlayView.setMap(this.map))}getMap(){return this.map}getCenter(){let r=this.map.getCenter();return r?{lng:r.lng(),lat:r.lat()}:{lng:0,lat:0}}getZoom(){var r;return(r=this.map.getZoom())!=null?r:0}getBearing(){var r;return(r=this.map.getHeading())!=null?r:0}getPitch(){var r;return(r=this.map.getTilt())!=null?r:0}getMapBounds(){let r=this.map.getBounds();if(!r)return{sw:{lat:0,lng:0},ne:{lat:0,lng:0}};let a=r.getSouthWest(),t=r.getNorthEast();return{sw:{lat:a.lat(),lng:a.lng()},ne:{lat:t.lat(),lng:t.lng()}}}project(r){var u;if(!this.overlayView)return{x:0,y:0};let a=this.overlayView.getProjection();if(!a)return{x:0,y:0};let t=(u=globalThis.google)==null?void 0:u.maps;if(!t)return{x:0,y:0};let n=new t.LatLng(r[1],r[0]),c=a.fromLatLngToContainerPixel(n);return c?{x:c.x,y:c.y}:{x:0,y:0}}on(r,a){this.map.addListener(r,a)}off(r,a){var n;let t=(n=globalThis.google)==null?void 0:n.maps;t!=null&&t.event&&t.event.clearListeners(this.map,r)}resize(){var a;let r=(a=globalThis.google)==null?void 0:a.maps;r!=null&&r.event&&r.event.trigger(this.map,"resize")}remove(){this.cleanup(),this.overlayView&&(this.overlayView.setMap(null),this.overlayView=null)}};var R=class extends I{constructor(r){super(r);this.cleanupFns=[]}initialize(r){return this.markerManager=new _({mapInstance:this.map,mapboxgl:r.mapboxgl,onMarkerClick:r.onMarkerClick}),r.onRefresh&&this.attachEventListeners(r.onRefresh),this.markerManager}attachEventListeners(r){if(!this.map||typeof this.map.on!="function")return;["move","zoom","dragend","pitch","rotate"].forEach(t=>{this.map.on(t,r),this.cleanupFns.push(()=>{typeof this.map.off=="function"&&this.map.off(t,r)})})}getMarkerManager(){return this.markerManager}cleanup(){for(let r of this.cleanupFns)try{r()}catch{}this.cleanupFns.length=0}getMap(){return this.map}getCenter(){let r=this.map.getCenter();return{lng:r.lng,lat:r.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let r=this.map.getBounds(),a=r.getSouthWest(),t=r.getNorthEast();return{sw:{lat:a.lat,lng:a.lng},ne:{lat:t.lat,lng:t.lng}}}project(r){return this.map.project({lng:r[0],lat:r[1]})}on(r,a){this.map.on(r,a)}off(r,a){this.map.off(r,a)}resize(){this.map.resize()}remove(){this.cleanup(),this.map.remove()}};function W(i){let e=i.getCenter();return{longitude:e.lng,latitude:e.lat,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch()}}var ye=[{zoom:6,threshold:120},{zoom:8,threshold:108},{zoom:10,threshold:92},{zoom:12,threshold:80},{zoom:14,threshold:68},{zoom:16,threshold:56}];function J(i){for(let e of ye)if(i<=e.zoom)return e.threshold;return 48}function V({primaryType:i,markers:e,map:r,selectedMarkerId:a,zoom:t,collisionThresholdPx:n,dotCollisionThresholdPx:c}){if(!e.length)return[];if(!r)return e.map(m=>({kind:"primary",marker:m,key:`primary-${m.tripadvisor_id}`}));let u=e.map((m,y)=>{let s=m.location;if(typeof(s==null?void 0:s.lon)!="number"||typeof(s==null?void 0:s.lat)!="number")return null;let{x:g,y:v}=r.project([s.lon,s.lat]);return{marker:m,index:y,x:g,y:v}}).filter(m=>!!m);if(!u.length)return[];let f=J(t),o=ge(t),p=u.map((m,y)=>y),d=m=>p[m]===m?m:(p[m]=d(p[m]),p[m]),l=(m,y)=>{let s=d(m),g=d(y);s!==g&&(p[g]=s)};for(let m=0;m<u.length;m+=1)for(let y=m+1;y<u.length;y+=1){let s=u[m].x-u[y].x,g=u[m].y-u[y].y;Math.hypot(s,g)<=f&&l(m,y)}let h=new Map;for(let m of u){let y=d(m.index),s=h.get(y);s?s.push(m):h.set(y,[m])}let k=[];return h.forEach(m=>{if(m.length===1){let[{marker:M}]=m,P=M.type===i,L=a===M.tripadvisor_id;k.push({kind:"primary",marker:M,key:`primary-${M.tripadvisor_id}-p${P?1:0}-s${L?1:0}`});return}let y=[...m].sort((M,P)=>ke(P.marker,M.marker,i)),[s,...g]=y,v=s.marker.type===i,C=a===s.marker.tripadvisor_id;if(k.push({kind:"primary",marker:s.marker,key:`primary-${s.marker.tripadvisor_id}-p${v?1:0}-s${C?1:0}`}),!g.length)return;let x=[],b=[];if(g.forEach(M=>{if(a&&M.marker.tripadvisor_id===a){let P=M.marker.type===i;k.push({kind:"primary",marker:M.marker,key:`primary-${M.marker.tripadvisor_id}-p${P?1:0}-s1`});return}he(s,M)<=o?x.push(M):b.push(M)}),x.forEach(M=>{let P=M.marker.type===i;k.push({kind:"dot",marker:M.marker,key:`dot-${M.marker.tripadvisor_id}-p${P?1:0}-s0`,parentId:s.marker.tripadvisor_id})}),b.length){let M=V({markers:b.map(P=>P.marker),map:r,selectedMarkerId:a,zoom:t,primaryType:i,collisionThresholdPx:n,dotCollisionThresholdPx:c});k.push(...M)}}),k}function he(i,e){return Math.hypot(i.x-e.x,i.y-e.y)}function ge(i){let e=J(i);return Math.max(48,e)}function ke(i,e,r){var f,o;let a=i.type===r,t=e.type===r;if(a&&!t)return 1;if(!a&&t)return-1;let n=K(i)-K(e);if(n!==0)return n;let c=Z(i)-Z(e);if(c!==0)return c;let u=((f=i.reviews)!=null?f:0)-((o=e.reviews)!=null?o:0);return u!==0?u:i.tripadvisor_id-e.tripadvisor_id}function K(i){if(typeof i.rating=="number")return i.rating;if(i.rating===void 0||i.rating===null)return-1/0;let e=Number(i.rating);return Number.isNaN(e)?-1/0:e}function Z(i){var r,a,t;if(!((a=(r=i.pricing)==null?void 0:r.offer)!=null&&a.price))return-1/0;let e=Number(((t=i.pricing.offer.displayPrice)!=null?t:"0").replace(/[^0-9.,-]+/g,"").replace(/,/g,""));return Number.isNaN(e)?-1/0:e}var be={prod:"https://api.mapfirst.ai",test:"https://ta-backend-test-290791666935.us-central1.run.app"},D=class extends Error{constructor({message:e,status:r,code:a}){super(e),this.name="PropertiesFetchError",this.status=r,this.code=a}};async function ee(i,e,{signal:r}={}){var t,n;let a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:r});if(!a.ok){let c=`Unexpected response: ${a.status}`,u;try{let f=await a.json();c=(n=(t=f.detail)!=null?t:f.error)!=null?n:c,u=f.code}catch{}throw new D({message:c,status:a.status,code:u})}return await a.json()}function Y(i){return typeof i=="string"?i:i.toISOString().slice(0,10)}var X="Accommodation";function Me(){let e=new Date(Date.now()+864e6),r=(6-e.getDay()+7)%7,a=new Date(e.getTime()+r*864e5),t=a.getDay(),n=t===0?6:6-t,c=new Date(a.getTime()+(n+1)*864e5);return{checkIn:a,checkOut:c}}var G=class{constructor(e){this.options=e;this.properties=[];this.selectedMarkerId=null;this.destroyed=!1;this.clusterItems=[];var t,n,c,u,f,o,p,d,l,h,k,m,y,s;this.properties=[...(t=e.properties)!=null?t:[]],this.primaryType=e.primaryType,this.selectedMarkerId=(n=e.selectedMarkerId)!=null?n:null,this.environment=(c=e.environment)!=null?c:"prod",this.apiUrl=be[this.environment],this.mfid=(u=e.mfid)!=null?u:"default",this.requestBody=e.requestBody;let r=Q(e);this.fitBoundsPadding={top:(o=(f=e.fitBoundsPadding)==null?void 0:f.top)!=null?o:r?0:50,bottom:(d=(p=e.fitBoundsPadding)==null?void 0:p.bottom)!=null?d:r?0:160,left:(h=(l=e.fitBoundsPadding)==null?void 0:l.left)!=null?h:r?0:50,right:(m=(k=e.fitBoundsPadding)==null?void 0:k.right)!=null?m:r?0:50};let a=Me();this.state={center:[0,0],zoom:0,bounds:null,pendingBounds:null,tempBounds:null,properties:this.properties,primary:(y=this.primaryType)!=null?y:X,selectedPropertyId:this.selectedMarkerId,initialLoading:!0,isSearching:!1,firstCallDone:!1,filters:{checkIn:a.checkIn,checkOut:a.checkOut,numAdults:2,numRooms:1},activeLocation:{country:"",location_id:null,locationName:"",coordinates:[0,0]},isFlyToAnimating:!1,...e.state},this.callbacks=(s=e.callbacks)!=null?s:{},this.adapter=this.createAdapter(e),this.refresh(),this.requestBody&&this.autoLoadProperties()}async autoLoadProperties(){if(!this.requestBody)return;let e={filters:this.getFilters(),initial:!0,...this.requestBody};await this.runPropertiesSearch({body:e,onError:r=>{var a,t;this.handleError(r,"autoLoadProperties"),(t=(a=this.callbacks).onPropertiesLoadError)==null||t.call(a,r)}})}createAdapter(e){return ve(e)?this.initializeAdapter(new F(e.mapInstance),{maplibregl:e.maplibregl,onMarkerClick:e.onMarkerClick}):Q(e)?this.initializeAdapter(new z(e.mapInstance),{google:e.google,onMarkerClick:e.onMarkerClick}):Pe(e)?this.initializeAdapter(new R(e.mapInstance),{mapboxgl:e.mapboxgl,onMarkerClick:e.onMarkerClick}):e.adapter}initializeAdapter(e,r){var t;let a=(t=this.options.autoSelectOnClick)!=null?t:!0;return e.initialize({...r,onMarkerClick:n=>{var c;n.type!==this.primaryType&&this.setPrimaryType(n.type),a&&this.setSelectedMarker(n.tripadvisor_id===this.selectedMarkerId?null:n.tripadvisor_id),(c=r.onMarkerClick)==null||c.call(r,n)},onRefresh:()=>this.refresh()}),e}_setProperties(e){var r,a;this.ensureAlive(),this.properties=[...e],this.updateState({properties:e.filter(t=>{var n,c;return t.type==="Accommodation"?((c=(n=t.pricing)==null?void 0:n.offer)==null?void 0:c.availability)!=="unavailable":!0})}),(a=(r=this.callbacks).onPropertiesChange)==null||a.call(r,e),this.refresh()}addMarker(e){var r,a;this.ensureAlive(),this.properties=[...this.properties,e],this.updateState({properties:this.properties}),(a=(r=this.callbacks).onPropertiesChange)==null||a.call(r,this.properties),this.refresh()}clearProperties(){var e,r;this.ensureAlive(),this.properties=[],this.updateState({properties:[]}),(r=(e=this.callbacks).onPropertiesChange)==null||r.call(e,[]),this.refresh()}setPrimaryType(e){var r,a;this.ensureAlive(),this.primaryType!==e&&(this.primaryType=e,this.updateState({primary:e}),(a=(r=this.callbacks).onPrimaryTypeChange)==null||a.call(r,e),this.refresh())}setSelectedMarker(e){var r,a;this.ensureAlive(),this.selectedMarkerId!==e&&(this.selectedMarkerId=e,this.updateState({selectedPropertyId:e}),(a=(r=this.callbacks).onSelectedPropertyChange)==null||a.call(r,e),this.refresh())}getState(){return{...this.state}}handleError(e,r="MapFirstCore"){let a=e instanceof Error?e.message:String(e),t=e instanceof Error?e:new Error(a);console.error(`[${r}]`,a),this.callbacks.onError&&this.callbacks.onError(t,r)}updateState(e){this.state={...this.state,...e}}setState(e){var a,t,n,c,u,f,o,p,d,l,h,k,m,y;let r={...this.state};this.updateState(e),e.center!==void 0&&e.center!==r.center&&((t=(a=this.callbacks).onCenterChange)==null||t.call(a,e.center,this.state.zoom)),e.zoom!==void 0&&e.zoom!==r.zoom&&((c=(n=this.callbacks).onZoomChange)==null||c.call(n,e.zoom)),e.bounds!==void 0&&e.bounds!==r.bounds&&((f=(u=this.callbacks).onBoundsChange)==null||f.call(u,e.bounds)),e.filters!==void 0&&e.filters!==r.filters&&((p=(o=this.callbacks).onFiltersChange)==null||p.call(o,e.filters)),e.activeLocation!==void 0&&e.activeLocation!==r.activeLocation&&((l=(d=this.callbacks).onActiveLocationChange)==null||l.call(d,e.activeLocation)),e.initialLoading!==void 0&&e.initialLoading!==r.initialLoading&&((k=(h=this.callbacks).onLoadingStateChange)==null||k.call(h,e.initialLoading)),e.isSearching!==void 0&&e.isSearching!==r.isSearching&&((y=(m=this.callbacks).onSearchingStateChange)==null||y.call(m,e.isSearching))}setFilters(e){this.setState({filters:e})}setActiveLocation(e){this.setState({activeLocation:e})}setBounds(e){this.setState({bounds:e})}setPendingBounds(e){this.setState({pendingBounds:e})}setTempBounds(e){this.setState({tempBounds:e})}setLoading(e){this.setState({initialLoading:e})}setSearching(e){this.setState({isSearching:e})}setFlyToAnimating(e){this.setState({isFlyToAnimating:e})}flyMapTo(e,r,a,t=!0){this.ensureAlive(),this.setState({center:[r,e]}),typeof a=="number"&&this.setState({zoom:a});let n=this.adapter.getMap();if(n){if(t===!1){this.setFlyToAnimating(!1),n.jumpTo&&n.jumpTo({center:[e,r],...a!==null&&{zoom:a!=null?a:13}});return}this.setFlyToAnimating(!0),n.flyTo&&n.flyTo({center:[e,r],...a!==null&&{zoom:a!=null?a:13}})}}flyToPOIs(e,r,a=!0){var u,f,o;this.ensureAlive();let t=this.adapter.getMap();if(!t)return;let n=e;if((!n||n.length===0)&&(n=this.properties.filter(p=>p.location!==void 0&&(r!==void 0?p.type===r:!0)).map(p=>({lat:p.location.lat,lng:p.location.lon}))),!n||n.length===0)return;let c=!!((u=window.google)!=null&&u.maps)&&t.setCenter&&t.setZoom&&!t.flyTo;if(n.length===1){let p=n[0];c?(t.setCenter({lat:p.lat,lng:p.lng}),t.setZoom(13)):t.flyTo&&t.flyTo({center:[p.lng,p.lat],zoom:13})}else if(c){let p=(o=(f=window.google)==null?void 0:f.maps)==null?void 0:o.LatLngBounds;if(p){let d=new p;n.forEach(l=>{d.extend({lat:l.lat,lng:l.lng})}),this.setFlyToAnimating(!0),t.fitBounds(d,this.fitBoundsPadding)}}else if(t.fitBounds){let p=[[n[0].lng,n[0].lat],[n[0].lng,n[0].lat]];n.forEach(d=>{p[0][0]=Math.min(p[0][0],d.lng),p[0][1]=Math.min(p[0][1],d.lat),p[1][0]=Math.max(p[1][0],d.lng),p[1][1]=Math.max(p[1][1],d.lat)}),this.setFlyToAnimating(!0),t.fitBounds(p,{padding:this.fitBoundsPadding,animate:a})}}getFilters(){let e={...this.state.filters};return e.checkIn instanceof Date&&(e.checkIn=Y(e.checkIn)),e.checkOut instanceof Date&&(e.checkOut=Y(e.checkOut)),e}async loadProperties({fetchFn:e,onSuccess:r,onError:a}){this.ensureAlive(),this.setLoading(!0),this.setSearching(!0),this.clearProperties();try{let t=await e();if(this._setProperties(t),!this.primaryType&&t.length>0){let n=t.reduce((u,f)=>(u[f.type]=(u[f.type]||0)+1,u),{}),c=Object.entries(n).reduce((u,f)=>n[u[0]]>n[f[0]]?u:f)[0];this.setPrimaryType(c)}this.setState({firstCallDone:!0}),r==null||r(t)}catch(t){this.clearProperties(),a==null||a(t)}finally{this.setSearching(!1),this.setLoading(!1),this.setState({firstCallDone:!0})}}async pollForPricing({pollingLink:e,maxAttempts:r=15,delayMs:a=2e3,isCancelled:t,price:n,limit:c}){var d,l,h,k,m;if(this.ensureAlive(),!e)return{completed:!1};let u=!1,f,o=this.getFilters();c&&(o.limit=c);let p={filters:o,pollingLink:e};for(let y=0;y<r;y++){if(t!=null&&t())return{completed:u,pollData:f};try{let s=await fetch(`${this.apiUrl}/${this.mfid}/ta-polling`,{method:"POST",body:JSON.stringify(p),headers:{"Content-Type":"application/json"}});if(!s.ok)throw new D({message:`Poll failed: ${s.status}`,status:s.status});if(f=await s.json(),t!=null&&t())return{completed:u,pollData:f};let g=(l=(d=f==null?void 0:f.success)==null?void 0:d.results)!=null?l:[];if(g.length>0&&this.setProperties(v=>{let C=new Set(g.map(b=>b.tripadvisor_id)),x=v.filter(b=>b.type!=="Accommodation"||C.has(b.tripadvisor_id));return g.forEach(b=>{var P,L,T,$,q,U;if(!b.location)return;(L=(P=b.pricing)==null?void 0:P.offer)!=null&&L.price&&n&&((($=(T=b.pricing)==null?void 0:T.offer)==null?void 0:$.price)<(n==null?void 0:n.min)||((U=(q=b.pricing)==null?void 0:q.offer)==null?void 0:U.price)>(n==null?void 0:n.max))&&(b.pricing.availability="unavailable");let M=x.findIndex(re=>re.tripadvisor_id===b.tripadvisor_id);M>=0?x[M]=b:x.push(b)}),x}),(h=f==null?void 0:f.success)!=null&&h.isComplete){u=!0;break}}catch(s){this.handleError(s,"pollForPricing"),(m=(k=this.callbacks).onPropertiesLoadError)==null||m.call(k,s);break}y<r-1&&await new Promise(s=>setTimeout(s,a))}return{completed:u,pollData:f}}setProperties(e){let r=e(this.properties);this._setProperties(r)}mostCommonTypeFromProperties(e){let r=e.reduce((a,t)=>(a[t.type]=(a[t.type]||0)+1,a),{});return Object.entries(r).reduce((a,t)=>r[a[0]]>r[t[0]]?a:t)[0]}async runPropertiesSearch({body:e,beforeApplyProperties:r,smartFiltersClearable:a,onError:t}){var n,c,u,f,o,p,d;this.ensureAlive(),this.setState({firstCallDone:!1}),this.setSearching(!0),this.clearProperties();try{let l=await ee(`${this.apiUrl}/${this.mfid}/hotels`,e),h=null,k=30,m=l.filters.primary_type;if(r){let s=r(l);h=(n=s.price)!=null?n:null,k=(c=s.limit)!=null?c:30}let y=l.properties.some(s=>!!s.location);if(this._setProperties(l.properties),y&&this.flyToPOIs(l.properties.filter(s=>!!s.location&&(l.filters.primary_type?s.type===l.filters.primary_type:!0)).map(s=>({lat:s.location.lat,lng:s.location.lon})),void 0,e.initial!==!0),l.filters.primary_type&&l.properties.filter(s=>{var g;return s.type===l.filters.primary_type&&(s.type==="Accommodation"?((g=s.pricing)==null?void 0:g.availability)!=="unavailable":!0)}).length>0)m=l.filters.primary_type,this.setPrimaryType(l.filters.primary_type);else if(l.properties.length>0){let s=this.mostCommonTypeFromProperties(l.properties);this.setPrimaryType(s),m=s}if(this.setState({firstCallDone:!0}),l.isComplete===!1&&l.pollingLink){let{completed:s,pollData:g}=await this.pollForPricing({pollingLink:l.pollingLink,...h&&{price:h},...k&&{limit:k}});if(s&&((u=g==null?void 0:g.success)!=null&&u.results)&&g.success.results.filter(v=>{var C;return v.type===l.filters.primary_type&&(v.type==="Accommodation"?((C=v.pricing)==null?void 0:C.availability)!=="unavailable":!0)}).length===0&&m&&m!==l.filters.primary_type){let v=this.mostCommonTypeFromProperties(l.properties);this.setPrimaryType(v)}}return y||(l.properties.some(s=>!!s.location)?this.flyToPOIs(l.properties.filter(s=>!!s.location&&(l.filters.primary_type?s.type===l.filters.primary_type:!0)).map(s=>({lat:s.location.lat,lng:s.location.lon})),void 0,e.initial!==!0):(f=l.filters.location)!=null&&f.latitude&&((o=l.filters.location)!=null&&o.longitude)&&this.flyMapTo(l.filters.location.longitude,l.filters.location.latitude,12,e.initial!==!0)),l}catch(l){return this.handleError(l,"runPropertiesSearch"),t==null||t(l),(d=(p=this.callbacks).onPropertiesLoadError)==null||d.call(p,l),this.clearProperties(),this.setState({firstCallDone:!0}),null}finally{this.setSearching(!1),this.setState({firstCallDone:!0})}}getClusters(){return this.ensureAlive(),[...this.clusterItems]}refresh(){var t,n,c;this.ensureAlive();let e=this.safeExtractViewState(),r=this.resolvePrimaryType();this.clusterItems=V({primaryType:r,markers:this.properties,map:this.adapter,selectedMarkerId:this.selectedMarkerId,zoom:(t=e==null?void 0:e.zoom)!=null?t:0}),this.adapter.getMarkerManager().render(this.clusterItems,r,this.selectedMarkerId),(c=(n=this.options).onClusterUpdate)==null||c.call(n,this.clusterItems,e)}destroy(){if(this.destroyed)return;this.adapter.getMarkerManager().destroy(),this.adapter.cleanup(),this.clusterItems=[],this.properties=[],this.destroyed=!0}resolvePrimaryType(){var e,r,a;return(a=(r=this.primaryType)!=null?r:(e=this.properties.find(t=>t.type))==null?void 0:e.type)!=null?a:X}safeExtractViewState(){try{return W(this.adapter)}catch{return null}}ensureAlive(){if(this.destroyed)throw new Error("MapFirstCore instance has been destroyed")}};function ve(i){return i.platform==="maplibre"}function Q(i){return i.platform==="google"}function Pe(i){return i.platform==="mapbox"}0&&(module.exports={MapFirstCore,PropertiesFetchError,fetchProperties});
//# sourceMappingURL=index.js.map