function O(a,{insertAt:r}={}){if(!a||typeof document=="undefined")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",r==="top"&&e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t),t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a))}O(`.mapfirst-marker-root{display:flex;z-index:20;flex-direction:column;align-items:center;pointer-events:auto}.mapfirst-marker-pill{border:2px solid;border-radius:999px;padding:8px;font-size:16px;font-weight:600;font-family:system-ui,-apple-system,sans-serif;box-shadow:0 4px 6px #6b728080;display:flex;align-items:center;justify-content:center;position:relative;transition:transform .2s;transform-origin:center bottom}.mapfirst-marker-pill-pending{background:#ffffff80;backdrop-filter:blur(4px);border-color:transparent;cursor:default}.mapfirst-marker-pill-active{background:#012b11;border-color:#fff;color:#fff;cursor:pointer}.mapfirst-marker-pill-active:hover{transform:scale(1.2)}.mapfirst-marker-badge{position:absolute;top:-12px;right:-20px}.mapfirst-marker-award-container{position:relative;width:32px;height:32px}.mapfirst-marker-award-back{position:absolute;stroke:#f5f5f5;stroke-width:2px}.mapfirst-marker-award-dot{position:absolute;top:6.2px;left:6.3px;width:18.5px;height:18.5px;border-radius:50%;z-index:1}.mapfirst-marker-award-dot-type-0{background:#ffef0e}.mapfirst-marker-award-dot-type-1{background:#01ea5b}.mapfirst-marker-award-front{position:relative;z-index:2;color:#012b11}.mapfirst-marker-rating-badge{display:flex;align-items:center;justify-content:center;border-radius:999px;background:#03852e;color:#fff;font-size:12px;line-height:1;box-shadow:0 2px 4px #0003;padding:2px 6px;border:2px solid #ffffff;font-weight:400}.mapfirst-marker-content{display:flex;align-items:center}.mapfirst-dot-marker-container{display:flex;z-index:10;align-items:center;justify-content:center;pointer-events:auto}.mapfirst-dot-marker-button{width:20px;height:20px;border-radius:999px;border:2px solid #ffffff;box-shadow:0 2px 4px #6b728066;transition:transform .2s;outline:none;transform-origin:center center}.mapfirst-dot-marker-button-pending{background:#d1d5db;cursor:default}.mapfirst-dot-marker-button-active{background:#012b11;cursor:pointer}.mapfirst-dot-marker-button-active:hover{transform:scale(1.2)}.mapfirst-dot-marker-button-active:focus{outline:2px solid #ffffff;outline-offset:2px}
`);function C(a,r){var p,u,h;if(typeof document=="undefined")return null;let e=a.marker,n=e.type==="Accommodation"&&((u=(p=e.pricing)==null?void 0:p.offer)==null?void 0:u.availability)!=="available",o=document.createElement("div");o.className="mapfirst-dot-marker-container";let i=document.createElement("button");return i.type="button",i.className=n?"mapfirst-dot-marker-button mapfirst-dot-marker-button-pending":"mapfirst-dot-marker-button mapfirst-dot-marker-button-active",i.title=(h=e.name)!=null?h:String(e.tripadvisor_id),i.addEventListener("click",y=>{y.stopPropagation(),n||r==null||r(e)}),o.appendChild(i),o}var F='<svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M12 3.953a7.442 7.442 0 1 0 .001 14.884A7.442 7.442 0 0 0 12 3.953m0 14.05a6.61 6.61 0 1 1 0-13.218 6.61 6.61 0 0 1 0 13.219M10.343 11.9a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.821 0m5.134 0a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.82 0m.82-1.897.84-.913h-1.863A5.8 5.8 0 0 0 12 8.08a5.77 5.77 0 0 0-3.27 1.008H6.862l.84.913a2.567 2.567 0 1 0 3.475 3.78l.823.896.823-.895a2.568 2.568 0 1 0 3.474-3.78m-6.865 3.634a1.738 1.738 0 1 1 0-3.476 1.738 1.738 0 0 1 0 3.476M12 11.85c0-1.143-.832-2.124-1.929-2.543A5 5 0 0 1 12 8.92a5 5 0 0 1 1.928.386c-1.096.42-1.927 1.4-1.927 2.543m2.566 1.787a1.738 1.738 0 1 1 .001-3.476 1.738 1.738 0 0 1 0 3.476m-8.456 3.719s-.377-.946-1.396-1.903c-1.02-.957-2.303-1.132-2.303-1.132s.457 1.02 1.54 2.04c1.086 1.017 2.159.995 2.159.995m2.568 1.41s-.524-.511-1.479-.883-1.861-.191-1.861-.191.598.54 1.615.935c1.016.397 1.725.139 1.725.139m2.493.505s-.545-.224-1.357-.196-1.415.47-1.415.47.608.222 1.473.193 1.3-.467 1.3-.467m-6.186-4.203s-.175-1.008-.974-2.154c-.8-1.147-2.015-1.578-2.015-1.578s.238 1.098 1.089 2.319c.85 1.22 1.9 1.413 1.9 1.413m-1.003-3.071s.195-1.021-.134-2.393c-.328-1.371-1.294-2.21-1.294-2.21s-.17 1.128.18 2.589c.35 1.46 1.248 2.014 1.248 2.014"></path><path d="M17.887 17.355s.377-.946 1.396-1.903c1.02-.957 2.303-1.132 2.303-1.132s-.457 1.02-1.54 2.04c-1.086 1.017-2.159.995-2.159.995m-2.567 1.41s.524-.511 1.479-.883 1.861-.191 1.861-.191-.598.54-1.615.935c-1.016.397-1.725.139-1.725.139m-2.493.505s.545-.224 1.357-.196 1.415.47 1.415.47-.608.222-1.473.193-1.3-.467-1.3-.467m6.186-4.203s.175-1.008.974-2.154c.8-1.147 2.015-1.578 2.015-1.578s-.238 1.098-1.089 2.319c-.85 1.22-1.9 1.413-1.9 1.413m1.003-3.071s-.195-1.021.133-2.393c.33-1.371 1.293-2.21 1.293-2.21s.17 1.128-.18 2.589c-.349 1.46-1.246 2.014-1.246 2.014M12 20.047a.413.413 0 1 0 0-.827.413.413 0 0 0 0 .827"></path></svg>',V='<svg viewBox="0 0 24 24" width="32" height="32"><path d="M12 3.953a7.442 7.442 0 1 0 .001 14.884A7.442 7.442 0 0 0 12 3.953m0 14.05a6.61 6.61 0 1 1 0-13.218 6.61 6.61 0 0 1 0 13.219M10.343 11.9a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.821 0m5.134 0a.91.91 0 1 1-1.821 0 .91.91 0 0 1 1.82 0m.82-1.897.84-.913h-1.863A5.8 5.8 0 0 0 12 8.08a5.77 5.77 0 0 0-3.27 1.008H6.862l.84.913a2.567 2.567 0 1 0 3.475 3.78l.823.896.823-.895a2.568 2.568 0 1 0 3.474-3.78m-6.865 3.634a1.738 1.738 0 1 1 0-3.476 1.738 1.738 0 0 1 0 3.476M12 11.85c0-1.143-.832-2.124-1.929-2.543A5 5 0 0 1 12 8.92a5 5 0 0 1 1.928.386c-1.096.42-1.927 1.4-1.927 2.543m2.566 1.787a1.738 1.738 0 1 1 .001-3.476 1.738 1.738 0 0 1 0 3.476m-8.456 3.719s-.377-.946-1.396-1.903c-1.02-.957-2.303-1.132-2.303-1.132s.457 1.02 1.54 2.04c1.086 1.017 2.159.995 2.159.995m2.568 1.41s-.524-.511-1.479-.883-1.861-.191-1.861-.191.598.54 1.615.935c1.016.397 1.725.139 1.725.139m2.493.505s-.545-.224-1.357-.196-1.415.47-1.415.47.608.222 1.473.193 1.3-.467 1.3-.467m-6.186-4.203s-.175-1.008-.974-2.154c-.8-1.147-2.015-1.578-2.015-1.578s.238 1.098 1.089 2.319c.85 1.22 1.9 1.413 1.9 1.413m-1.003-3.071s.195-1.021-.134-2.393c-.328-1.371-1.294-2.21-1.294-2.21s-.17 1.128.18 2.589c.35 1.46 1.248 2.014 1.248 2.014"></path><path d="M17.887 17.355s.377-.946 1.396-1.903c1.02-.957 2.303-1.132 2.303-1.132s-.457 1.02-1.54 2.04c-1.086 1.017-2.159.995-2.159.995m-2.567 1.41s.524-.511 1.479-.883 1.861-.191 1.861-.191-.598.54-1.615.935c-1.016.397-1.725.139-1.725.139m-2.493.505s.545-.224 1.357-.196 1.415.47 1.415.47-.608.222-1.473.193-1.3-.467-1.3-.467m6.186-4.203s.175-1.008.974-2.154c.8-1.147 2.015-1.578 2.015-1.578s-.238 1.098-1.089 2.319c-.85 1.22-1.9 1.413-1.9 1.413m1.003-3.071s-.195-1.021.133-2.393c.33-1.371 1.293-2.21 1.293-2.21s.17 1.128-.18 2.589c-.349 1.46-1.246 2.014-1.246 2.014M12 20.047a.413.413 0 1 0 0-.827.413.413 0 0 0 0 .827"></path></svg>',G='<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.051 6.549v.003l1.134 1.14 3.241-3.25.003-.002 1.134 1.136-3.243 3.252 1.134 1.14a1 1 0 0 0 .09-.008c.293-.05.573-.324.72-.474l.005-.006 2.596-2.603L22 8.016l-2.597 2.604a3.73 3.73 0 0 1-1.982 1.015 4.3 4.3 0 0 1-3.162-.657l-.023-.016-.026-.018-1.366 1.407 8.509 8.512L20.219 22l-.002-.002-6.654-6.663-2.597 2.76-7.3-7.315C1.967 8.948 1.531 6.274 2.524 4.198c.241-.504.566-.973.978-1.386l8.154 8.416 1.418-1.423-.039-.045c-.858-1.002-1.048-2.368-.62-3.595a4.15 4.15 0 0 1 .983-1.561L16 2l1.135 1.138-2.598 2.602-.047.045c-.16.151-.394.374-.433.678zM3.809 5.523c-.362 1.319-.037 2.905 1.06 4.103L10.93 15.7l1.408-1.496zM2.205 20.697 3.34 21.84l4.543-4.552-1.135-1.143z"/></svg>',j='<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.56 7.5H3.75a.25.25 0 0 0-.25.25v10c0 .138.112.25.25.25h16.5a.25.25 0 0 0 .25-.25v-10a.25.25 0 0 0-.25-.25h-3.81l-2-2H9.56zM8.94 4h6.12l2 2h3.19c.966 0 1.75.784 1.75 1.75v10a1.75 1.75 0 0 1-1.75 1.75H3.75A1.75 1.75 0 0 1 2 17.75v-10C2 6.784 2.784 6 3.75 6h3.19z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12 9.25a2.75 2.75 0 1 0 0 5.5 2.75 2.75 0 0 0 0-5.5M7.75 12a4.25 4.25 0 1 1 8.5 0 4.25 4.25 0 0 1-8.5 0"/></svg>';function P(a,r){var y,M,I,x,k,s,c,m;if(typeof document=="undefined")return null;let e=a.marker,t=e.type==="Accommodation",n=(M=(y=e.pricing)==null?void 0:y.offer)==null?void 0:M.displayPrice,o=t&&!n,i=(()=>{if(e.rating===void 0||e.rating===null)return null;let l=typeof e.rating=="number"?e.rating:Number(e.rating);return Number.isNaN(l)||l<=0?null:l.toFixed(1)})(),p=document.createElement("div");p.className="mapfirst-marker-root";let u=document.createElement("button");if(u.type="button",u.className=o?"mapfirst-marker-pill mapfirst-marker-pill-pending":"mapfirst-marker-pill mapfirst-marker-pill-active",u.title=(I=e.name)!=null?I:String(e.tripadvisor_id),!o&&((x=e.awards)!=null&&x.length||i)){let l=document.createElement("div");if(l.className="mapfirst-marker-badge",(k=e.awards)!=null&&k.length&&e.awards[0].type){let f=document.createElement("div");f.className="mapfirst-marker-award-container";let b=document.createElement("div");b.className="mapfirst-marker-award-back",b.innerHTML=V;let d=document.createElement("div");d.className=`mapfirst-marker-award-dot mapfirst-marker-award-dot-type-${e.awards[0].type}`;let v=document.createElement("div");v.className="mapfirst-marker-award-front",v.innerHTML=F,f.appendChild(b),f.appendChild(d),f.appendChild(v),l.appendChild(f)}else i&&(l.className="mapfirst-marker-badge mapfirst-marker-rating-badge",l.textContent=i);u.appendChild(l)}let h=document.createElement("span");return h.className="mapfirst-marker-content",t?h.textContent=(m=(c=(s=e.pricing)==null?void 0:s.offer)==null?void 0:c.displayPrice)!=null?m:"\u2014":e.type==="Eat & Drink"?h.innerHTML=G:e.type==="Attraction"&&(h.innerHTML=j),u.appendChild(h),u.addEventListener("click",l=>{l.stopPropagation(),o||r==null||r(e)}),p.appendChild(u),p}var w=class{constructor(r){this.markerCache=new Map;var e;this.mapInstance=r.mapInstance,this.MarkerCtor=(e=r.maplibregl)==null?void 0:e.Marker,this.onMarkerClick=r.onMarkerClick}render(r){if(!this.MarkerCtor)return;let e=new Set(r.map(t=>t.key));for(let[t,n]of this.markerCache.entries())if(!e.has(t)){try{n.marker.remove()}catch{}this.markerCache.delete(t)}for(let t of r){let n=R(t.marker.location);if(!n)continue;let o=this.markerCache.get(t.key);if(o)try{o.marker.setLngLat([n.lon,n.lat])}catch{try{o.marker.remove()}catch{}this.markerCache.delete(t.key),this.createAndAddMarker(t,n)}else this.createAndAddMarker(t,n)}}destroy(){for(let r of this.markerCache.values())try{r.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(r,e){if(!this.MarkerCtor)return;let t=r.kind==="primary"?P(r,this.onMarkerClick):C(r,this.onMarkerClick);if(t)try{let n=new this.MarkerCtor({element:t,anchor:r.kind==="primary"?"bottom":"center"}).setLngLat([e.lon,e.lat]).addTo(this.mapInstance);this.markerCache.set(r.key,{key:r.key,marker:n,kind:r.kind,parentId:r.kind==="dot"?r.parentId:void 0})}catch{}}};function R(a){return typeof(a==null?void 0:a.lon)!="number"||typeof(a==null?void 0:a.lat)!="number"||Number.isNaN(a.lon)||Number.isNaN(a.lat)?null:{lon:a.lon,lat:a.lat}}var L=class{constructor(r){this.markerCache=new Map;this.mapInstance=r.mapInstance,this.google=r.google,this.onMarkerClick=r.onMarkerClick}render(r){var t,n;if(!((n=(t=this.google)==null?void 0:t.marker)!=null&&n.AdvancedMarkerElement)){console.warn("AdvancedMarkerElement not available");return}let e=new Set(r.map(o=>o.key));for(let[o,i]of this.markerCache.entries())if(!e.has(o)){try{i.marker.map=null}catch(p){console.error("Error removing marker",p)}this.markerCache.delete(o)}for(let o of r){let i=Z(o.marker.location);if(!i)continue;let p=this.markerCache.get(o.key);if(p)try{p.marker.position={lat:i.lat,lng:i.lon}}catch{try{p.marker.map=null}catch(u){console.error("Error removing marker",u)}this.markerCache.delete(o.key),this.createAndAddMarker(o,i)}else this.createAndAddMarker(o,i)}}destroy(){for(let r of this.markerCache.values())try{r.marker.map=null}catch(e){console.error("Error removing marker",e)}this.markerCache.clear()}createAndAddMarker(r,e){var n,o;if(!((o=(n=this.google)==null?void 0:n.marker)!=null&&o.AdvancedMarkerElement))return;let t=r.kind==="primary"?P(r,this.onMarkerClick):C(r,this.onMarkerClick);if(t)try{let i=new this.google.marker.AdvancedMarkerElement({map:this.mapInstance,position:{lat:e.lat,lng:e.lon},content:t,zIndex:r.kind==="primary"?20:10});this.markerCache.set(r.key,{key:r.key,marker:i,kind:r.kind,parentId:r.kind==="dot"?r.parentId:void 0})}catch(i){console.error("Error creating marker",i)}}};function Z(a){return typeof(a==null?void 0:a.lon)!="number"||typeof(a==null?void 0:a.lat)!="number"||Number.isNaN(a.lon)||Number.isNaN(a.lat)?null:{lon:a.lon,lat:a.lat}}var A=class{constructor(r){this.markerCache=new Map;var e;this.mapInstance=r.mapInstance,this.MarkerCtor=(e=r.mapboxgl)==null?void 0:e.Marker,this.onMarkerClick=r.onMarkerClick}render(r){if(!this.MarkerCtor)return;let e=new Set(r.map(t=>t.key));for(let[t,n]of this.markerCache.entries())if(!e.has(t)){try{n.marker.remove()}catch{}this.markerCache.delete(t)}for(let t of r){let n=K(t.marker.location);if(!n)continue;let o=this.markerCache.get(t.key);if(o)try{o.marker.setLngLat([n.lon,n.lat])}catch{try{o.marker.remove()}catch{}this.markerCache.delete(t.key),this.createAndAddMarker(t,n)}else this.createAndAddMarker(t,n)}}destroy(){for(let r of this.markerCache.values())try{r.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(r,e){if(!this.MarkerCtor)return;let t=r.kind==="primary"?P(r,this.onMarkerClick):C(r,this.onMarkerClick);if(t)try{let n=new this.MarkerCtor({element:t,anchor:r.kind==="primary"?"bottom":"center"}).setLngLat([e.lon,e.lat]).addTo(this.mapInstance);this.markerCache.set(r.key,{key:r.key,marker:n,kind:r.kind,parentId:r.kind==="dot"?r.parentId:void 0})}catch{}}};function K(a){return typeof(a==null?void 0:a.lon)!="number"||typeof(a==null?void 0:a.lat)!="number"||Number.isNaN(a.lon)||Number.isNaN(a.lat)?null:{lon:a.lon,lat:a.lat}}var g=class{constructor(r){this.map=r}getMap(){return this.map}};var N=class extends g{constructor(e){super(e);this.cleanupFns=[]}initialize(e){return this.markerManager=new w({mapInstance:this.map,maplibregl:e.maplibregl,onMarkerClick:e.onMarkerClick}),e.onRefresh&&this.attachEventListeners(e.onRefresh),this.markerManager}attachEventListeners(e){if(!this.map||typeof this.map.on!="function")return;["move","zoom","dragend","pitch","rotate"].forEach(n=>{this.map.on(n,e),this.cleanupFns.push(()=>{typeof this.map.off=="function"&&this.map.off(n,e)})})}getMarkerManager(){return this.markerManager}cleanup(){for(let e of this.cleanupFns)try{e()}catch{}this.cleanupFns.length=0}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return{sw:{lat:t.lat,lng:t.lng},ne:{lat:n.lat,lng:n.lng}}}project(e){return this.map.project({lng:e[0],lat:e[1]})}on(e,t){this.map.on(e,t)}off(e,t){this.map.off(e,t)}resize(){this.map.resize()}remove(){this.cleanup(),this.map.remove()}};var E=class extends g{constructor(e){super(e);this.cleanupFns=[];this.initializeOverlayView()}initialize(e){return this.markerManager=new L({mapInstance:this.map,google:e.google,onMarkerClick:e.onMarkerClick}),e.onRefresh&&this.attachEventListeners(e.onRefresh),this.markerManager}attachEventListeners(e){let t=["center_changed","zoom_changed","drag","heading_changed","tilt_changed"],n=[];t.forEach(o=>{let i=this.map.addListener(o,e);n.push(i)}),this.cleanupFns.push(()=>{n.forEach(o=>{try{o.remove()}catch{}})})}getMarkerManager(){return this.markerManager}cleanup(){for(let e of this.cleanupFns)try{e()}catch{}this.cleanupFns.length=0}initializeOverlayView(){var n;let e=(n=globalThis.google)==null?void 0:n.maps;if(!e)return;let t=e.OverlayView;t&&(this.overlayView=new t,this.overlayView.draw=function(){},this.overlayView.setMap(this.map))}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return e?{lng:e.lng(),lat:e.lat()}:{lng:0,lat:0}}getZoom(){var e;return(e=this.map.getZoom())!=null?e:0}getBearing(){var e;return(e=this.map.getHeading())!=null?e:0}getPitch(){var e;return(e=this.map.getTilt())!=null?e:0}getMapBounds(){let e=this.map.getBounds();if(!e)return{sw:{lat:0,lng:0},ne:{lat:0,lng:0}};let t=e.getSouthWest(),n=e.getNorthEast();return{sw:{lat:t.lat(),lng:t.lng()},ne:{lat:n.lat(),lng:n.lng()}}}project(e){var p;if(!this.overlayView)return{x:0,y:0};let t=this.overlayView.getProjection();if(!t)return{x:0,y:0};let n=(p=globalThis.google)==null?void 0:p.maps;if(!n)return{x:0,y:0};let o=new n.LatLng(e[1],e[0]),i=t.fromLatLngToContainerPixel(o);return i?{x:i.x,y:i.y}:{x:0,y:0}}on(e,t){this.map.addListener(e,t)}off(e,t){var o;let n=(o=globalThis.google)==null?void 0:o.maps;n!=null&&n.event&&n.event.clearListeners(this.map,e)}resize(){var t;let e=(t=globalThis.google)==null?void 0:t.maps;e!=null&&e.event&&e.event.trigger(this.map,"resize")}remove(){this.cleanup(),this.overlayView&&(this.overlayView.setMap(null),this.overlayView=null)}};var T=class extends g{constructor(e){super(e);this.cleanupFns=[]}initialize(e){return this.markerManager=new A({mapInstance:this.map,mapboxgl:e.mapboxgl,onMarkerClick:e.onMarkerClick}),e.onRefresh&&this.attachEventListeners(e.onRefresh),this.markerManager}attachEventListeners(e){if(!this.map||typeof this.map.on!="function")return;["move","zoom","dragend","pitch","rotate"].forEach(n=>{this.map.on(n,e),this.cleanupFns.push(()=>{typeof this.map.off=="function"&&this.map.off(n,e)})})}getMarkerManager(){return this.markerManager}cleanup(){for(let e of this.cleanupFns)try{e()}catch{}this.cleanupFns.length=0}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return{sw:{lat:t.lat,lng:t.lng},ne:{lat:n.lat,lng:n.lng}}}project(e){return this.map.project({lng:e[0],lat:e[1]})}on(e,t){this.map.on(e,t)}off(e,t){this.map.off(e,t)}resize(){this.map.resize()}remove(){this.cleanup(),this.map.remove()}};function S(a){let r=a.getCenter();return{longitude:r.lng,latitude:r.lat,zoom:a.getZoom(),bearing:a.getBearing(),pitch:a.getPitch()}}var $=[{zoom:6,threshold:120},{zoom:8,threshold:108},{zoom:10,threshold:92},{zoom:12,threshold:80},{zoom:14,threshold:68},{zoom:16,threshold:56}];function H(a){for(let r of $)if(a<=r.zoom)return r.threshold;return 48}function z({primaryType:a,markers:r,map:e,selectedMarkerId:t,zoom:n,collisionThresholdPx:o,dotCollisionThresholdPx:i}){if(!r.length)return[];if(!e)return r.map(s=>({kind:"primary",marker:s,key:`primary-${s.tripadvisor_id}`}));let p=r.map((s,c)=>{let m=s.location;if(typeof(m==null?void 0:m.lon)!="number"||typeof(m==null?void 0:m.lat)!="number")return null;let{x:l,y:f}=e.project([m.lon,m.lat]);return{marker:s,index:c,x:l,y:f}}).filter(s=>!!s);if(!p.length)return[];let u=H(n),h=U(n),y=p.map((s,c)=>c),M=s=>y[s]===s?s:(y[s]=M(y[s]),y[s]),I=(s,c)=>{let m=M(s),l=M(c);m!==l&&(y[l]=m)};for(let s=0;s<p.length;s+=1)for(let c=s+1;c<p.length;c+=1){let m=p[s].x-p[c].x,l=p[s].y-p[c].y;Math.hypot(m,l)<=u&&I(s,c)}let x=new Map;for(let s of p){let c=M(s.index),m=x.get(c);m?m.push(s):x.set(c,[s])}let k=[];return x.forEach(s=>{if(s.length===1){let[{marker:d}]=s;k.push({kind:"primary",marker:d,key:`primary-${d.tripadvisor_id}`});return}let c=[...s].sort((d,v)=>Y(v.marker,d.marker,a)),[m,...l]=c;if(k.push({kind:"primary",marker:m.marker,key:`primary-${m.marker.tripadvisor_id}`}),!l.length)return;let f=[],b=[];if(l.forEach(d=>{if(t&&d.marker.tripadvisor_id===t){k.push({kind:"primary",marker:d.marker,key:`primary-${d.marker.tripadvisor_id}`});return}W(m,d)<=h?f.push(d):b.push(d)}),f.forEach(d=>{k.push({kind:"dot",marker:d.marker,key:`dot-${d.marker.tripadvisor_id}`,parentId:m.marker.tripadvisor_id})}),b.length){let d=z({markers:b.map(v=>v.marker),map:e,selectedMarkerId:t,zoom:n,primaryType:a,collisionThresholdPx:o,dotCollisionThresholdPx:i});k.push(...d)}}),k}function W(a,r){return Math.hypot(a.x-r.x,a.y-r.y)}function U(a){let r=H(a);return Math.max(48,r)}function Y(a,r,e){var u,h;let t=a.type===e,n=r.type===e;if(t&&!n)return 1;if(!t&&n)return-1;let o=B(a)-B(r);if(o!==0)return o;let i=D(a)-D(r);if(i!==0)return i;let p=((u=a.reviews)!=null?u:0)-((h=r.reviews)!=null?h:0);return p!==0?p:a.tripadvisor_id-r.tripadvisor_id}function B(a){if(typeof a.rating=="number")return a.rating;if(a.rating===void 0||a.rating===null)return-1/0;let r=Number(a.rating);return Number.isNaN(r)?-1/0:r}function D(a){var e,t,n;if(!((t=(e=a.pricing)==null?void 0:e.offer)!=null&&t.price))return-1/0;let r=Number(((n=a.pricing.offer.displayPrice)!=null?n:"0").replace(/[^0-9.,-]+/g,"").replace(/,/g,""));return Number.isNaN(r)?-1/0:r}var X="Accommodation",_=class{constructor(r){this.options=r;this.markers=[];this.selectedMarkerId=null;this.destroyed=!1;this.clusterItems=[];var e,t;this.markers=[...(e=r.markers)!=null?e:[]],this.primaryType=r.primaryType,this.selectedMarkerId=(t=r.selectedMarkerId)!=null?t:null,this.adapter=this.createAdapter(r),this.refresh()}createAdapter(r){return q(r)?this.initializeAdapter(new N(r.mapInstance),{maplibregl:r.maplibregl,onMarkerClick:r.onMarkerClick}):J(r)?this.initializeAdapter(new E(r.mapInstance),{google:r.google,onMarkerClick:r.onMarkerClick}):Q(r)?this.initializeAdapter(new T(r.mapInstance),{mapboxgl:r.mapboxgl,onMarkerClick:r.onMarkerClick}):r.adapter}initializeAdapter(r,e){var n;let t=(n=this.options.autoSelectOnClick)!=null?n:!0;return r.initialize({...e,onMarkerClick:o=>{var i;t&&this.setSelectedMarker(o.tripadvisor_id),(i=e.onMarkerClick)==null||i.call(e,o)},onRefresh:()=>this.refresh()}),r}setMarkers(r){this.ensureAlive(),this.markers=[...r],this.refresh()}addMarker(r){this.ensureAlive(),this.markers=[...this.markers,r],this.refresh()}clearMarkers(){this.ensureAlive(),this.markers=[],this.refresh()}setPrimaryType(r){this.ensureAlive(),this.primaryType!==r&&(this.primaryType=r,this.refresh())}setSelectedMarker(r){this.ensureAlive(),this.selectedMarkerId!==r&&(this.selectedMarkerId=r,this.refresh())}getClusters(){return this.ensureAlive(),[...this.clusterItems]}refresh(){var n,o,i;this.ensureAlive();let r=this.safeExtractViewState(),e=this.resolvePrimaryType();this.clusterItems=z({primaryType:e,markers:this.markers,map:this.adapter,selectedMarkerId:this.selectedMarkerId,zoom:(n=r==null?void 0:r.zoom)!=null?n:0}),this.adapter.getMarkerManager().render(this.clusterItems),(i=(o=this.options).onClusterUpdate)==null||i.call(o,this.clusterItems,r)}destroy(){if(this.destroyed)return;this.adapter.getMarkerManager().destroy(),this.adapter.cleanup(),this.clusterItems=[],this.markers=[],this.destroyed=!0}resolvePrimaryType(){var r,e,t;return(t=(e=this.primaryType)!=null?e:(r=this.markers.find(n=>n.type))==null?void 0:r.type)!=null?t:X}safeExtractViewState(){try{return S(this.adapter)}catch{return null}}ensureAlive(){if(this.destroyed)throw new Error("MapFirstCore instance has been destroyed")}};function q(a){return a.platform==="maplibre"}function J(a){return a.platform==="google"}function Q(a){return a.platform==="mapbox"}export{_ as MapFirstCore};
//# sourceMappingURL=index.mjs.map