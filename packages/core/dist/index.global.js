"use strict";var MapFirstCore=(()=>{var A=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var V=(a,e)=>{for(var t in e)A(a,t,{get:e[t],enumerable:!0})},F=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!G.call(a,n)&&n!==t&&A(a,n,{get:()=>e[n],enumerable:!(r=z(e,n))||r.enumerable});return a};var H=a=>F(A({},"__esModule",{value:!0}),a);var Q={};V(Q,{MapFirstCore:()=>E});function x(a,e){var r;if(typeof document=="undefined")return null;let t=document.createElement("button");return t.type="button",t.style.width="14px",t.style.height="14px",t.style.borderRadius="999px",t.style.border="2px solid #ffffff",t.style.background="#012b11",t.style.boxShadow="0 6px 16px rgba(15, 23, 42, 0.4)",t.style.cursor="pointer",t.title=(r=a.marker.name)!=null?r:String(a.marker.tripadvisor_id),t.addEventListener("click",n=>{n.stopPropagation(),e==null||e(a.marker)}),t}function P(a,e){var i,o,m,y;if(typeof document=="undefined")return null;let t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.pointerEvents="auto";let r=document.createElement("button");r.type="button",r.style.background="#012b11",r.style.color="#ffffff",r.style.border="none",r.style.borderRadius="999px",r.style.padding="6px 12px",r.style.fontSize="12px",r.style.fontWeight="600",r.style.fontFamily="system-ui, -apple-system, sans-serif",r.style.boxShadow="0 15px 30px rgba(15, 23, 42, 0.45)",r.style.cursor="pointer",r.style.display="flex",r.style.flexDirection="column",r.style.gap="2px",r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.style.zIndex="2",r.title=(i=a.marker.name)!=null?i:String(a.marker.tripadvisor_id);let n=document.createElement("span");n.textContent=(y=(m=(o=a.marker.pricing)==null?void 0:o.offer)==null?void 0:m.displayPrice)!=null?y:"No Price",n.style.textAlign="left",r.appendChild(n),r.addEventListener("click",h=>{h.stopPropagation(),e==null||e(a.marker)});let s=document.createElement("span");return s.style.width="0",s.style.height="0",s.style.borderLeft="6px solid transparent",s.style.borderRight="6px solid transparent",s.style.borderTop="8px solid #012b11",s.style.marginTop="4px",t.appendChild(r),t.appendChild(s),t}var k=class{constructor(e){this.markerCache=new Map;var t;this.mapInstance=e.mapInstance,this.MarkerCtor=(t=e.maplibregl)==null?void 0:t.Marker,this.onMarkerClick=e.onMarkerClick}render(e){if(!this.MarkerCtor)return;let t=new Set(e.map(r=>r.key));for(let[r,n]of this.markerCache.entries())if(!t.has(r)){try{n.marker.remove()}catch{}this.markerCache.delete(r)}for(let r of e){let n=j(r.marker.location);if(!n)continue;let s=this.markerCache.get(r.key);if(s)try{s.marker.setLngLat([n.lon,n.lat])}catch{try{s.marker.remove()}catch{}this.markerCache.delete(r.key),this.createAndAddMarker(r,n)}else this.createAndAddMarker(r,n)}}destroy(){for(let e of this.markerCache.values())try{e.marker.remove()}catch{}this.markerCache.clear()}createAndAddMarker(e,t){if(!this.MarkerCtor)return;let r=e.kind==="primary"?P(e,this.onMarkerClick):x(e,this.onMarkerClick);if(r)try{let n=new this.MarkerCtor({element:r,anchor:e.kind==="primary"?"bottom":"center"}).setLngLat([t.lon,t.lat]).addTo(this.mapInstance);this.markerCache.set(e.key,{key:e.key,marker:n,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch{}}};function j(a){return typeof(a==null?void 0:a.lon)!="number"||typeof(a==null?void 0:a.lat)!="number"||Number.isNaN(a.lon)||Number.isNaN(a.lat)?null:{lon:a.lon,lat:a.lat}}var M=class{constructor(e){this.markerCache=new Map;this.mapInstance=e.mapInstance,this.google=e.google,this.onMarkerClick=e.onMarkerClick}render(e){var r,n,s;if(!((s=(n=(r=this.google)==null?void 0:r.maps)==null?void 0:n.marker)!=null&&s.AdvancedMarkerElement))return;let t=new Set(e.map(i=>i.key));for(let[i,o]of this.markerCache.entries())if(!t.has(i)){try{o.marker.map=null}catch{}this.markerCache.delete(i)}for(let i of e){let o=R(i.marker.location);if(!o)continue;let m=this.markerCache.get(i.key);if(m)try{m.marker.position=new this.google.maps.LatLng(o.lat,o.lon)}catch{try{m.marker.map=null}catch{}this.markerCache.delete(i.key),this.createAndAddMarker(i,o)}else this.createAndAddMarker(i,o)}}destroy(){for(let e of this.markerCache.values())try{e.marker.map=null}catch{}this.markerCache.clear()}createAndAddMarker(e,t){var n,s,i;if(!((i=(s=(n=this.google)==null?void 0:n.maps)==null?void 0:s.marker)!=null&&i.AdvancedMarkerElement))return;let r=e.kind==="primary"?P(e,this.onMarkerClick):x(e,this.onMarkerClick);if(r)try{let o=new this.google.maps.marker.AdvancedMarkerElement({map:this.mapInstance,position:{lat:t.lat,lng:t.lon},content:r});this.markerCache.set(e.key,{key:e.key,marker:o,kind:e.kind,parentId:e.kind==="dot"?e.parentId:void 0})}catch{}}};function R(a){return typeof(a==null?void 0:a.lon)!="number"||typeof(a==null?void 0:a.lat)!="number"||Number.isNaN(a.lon)||Number.isNaN(a.lat)?null:{lon:a.lon,lat:a.lat}}var g=class{constructor(e){this.map=e}getMap(){return this.map}};var C=class extends g{constructor(e){super(e)}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}getZoom(){return this.map.getZoom()}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getMapBounds(){let e=this.map.getBounds(),t=e.getSouthWest(),r=e.getNorthEast();return{sw:{lat:t.lat,lng:t.lng},ne:{lat:r.lat,lng:r.lng}}}project(e){return this.map.project({lng:e[0],lat:e[1]})}on(e,t){this.map.on(e,t)}off(e,t){this.map.off(e,t)}resize(){this.map.resize()}remove(){this.map.remove()}};var L=class extends g{constructor(e){super(e),this.initializeOverlayView()}initializeOverlayView(){var r;let e=(r=globalThis.google)==null?void 0:r.maps;if(!e)return;let t=e.OverlayView;t&&(this.overlayView=new t,this.overlayView.draw=function(){},this.overlayView.setMap(this.map))}getMap(){return this.map}getCenter(){let e=this.map.getCenter();return e?{lng:e.lng(),lat:e.lat()}:{lng:0,lat:0}}getZoom(){var e;return(e=this.map.getZoom())!=null?e:0}getBearing(){var e;return(e=this.map.getHeading())!=null?e:0}getPitch(){var e;return(e=this.map.getTilt())!=null?e:0}getMapBounds(){let e=this.map.getBounds();if(!e)return{sw:{lat:0,lng:0},ne:{lat:0,lng:0}};let t=e.getSouthWest(),r=e.getNorthEast();return{sw:{lat:t.lat(),lng:t.lng()},ne:{lat:r.lat(),lng:r.lng()}}}project(e){var i;if(!this.overlayView)return{x:0,y:0};let t=this.overlayView.getProjection();if(!t)return{x:0,y:0};let r=(i=globalThis.google)==null?void 0:i.maps;if(!r)return{x:0,y:0};let n=new r.LatLng(e[1],e[0]),s=t.fromLatLngToContainerPixel(n);return s?{x:s.x,y:s.y}:{x:0,y:0}}on(e,t){this.map.addListener(e,t)}off(e,t){var n;let r=(n=globalThis.google)==null?void 0:n.maps;r!=null&&r.event&&r.event.clearListeners(this.map,e)}resize(){var t;let e=(t=globalThis.google)==null?void 0:t.maps;e!=null&&e.event&&e.event.trigger(this.map,"resize")}remove(){this.overlayView&&(this.overlayView.setMap(null),this.overlayView=null)}};var Z="Accommodation",E=class{constructor(e){this.options=e;this.cleanupFns=[];this.markers=[];this.selectedMarkerId=null;this.destroyed=!1;this.clusterItems=[];var t,r,n,s;if(this.markers=[...(t=e.markers)!=null?t:[]],this.primaryType=e.primaryType,this.selectedMarkerId=(r=e.selectedMarkerId)!=null?r:null,$(e)){let i=(n=e.autoSelectOnClick)!=null?n:!0;this.adapter=new C(e.mapInstance),this.markerRenderer=new k({mapInstance:e.mapInstance,maplibregl:e.maplibregl,onMarkerClick:o=>{var m;i&&this.setSelectedMarker(o.tripadvisor_id),(m=e.onMarkerClick)==null||m.call(e,o)}}),this.attachMapLibreListeners(e.mapInstance)}else if(U(e)){let i=(s=e.autoSelectOnClick)!=null?s:!0;this.adapter=new L(e.mapInstance),this.markerRenderer=new M({mapInstance:e.mapInstance,google:e.google,onMarkerClick:o=>{var m;i&&this.setSelectedMarker(o.tripadvisor_id),(m=e.onMarkerClick)==null||m.call(e,o)}}),this.attachGoogleMapsListeners(e.mapInstance)}else this.adapter=e.adapter;this.refresh()}setMarkers(e){this.ensureAlive(),this.markers=[...e],this.refresh()}addMarker(e){this.ensureAlive(),this.markers=[...this.markers,e],this.refresh()}clearMarkers(){this.ensureAlive(),this.markers=[],this.refresh()}setPrimaryType(e){this.ensureAlive(),this.primaryType!==e&&(this.primaryType=e,this.refresh())}setSelectedMarker(e){this.ensureAlive(),this.selectedMarkerId!==e&&(this.selectedMarkerId=e,this.refresh())}getClusters(){return this.ensureAlive(),[...this.clusterItems]}refresh(){var s,i,o,m;this.ensureAlive();let e=this.safeExtractViewState(),t=this.resolvePrimaryType(),{collisionPx:r,dotPx:n}=this.resolveCollisionOverrides(e);this.clusterItems=D({primaryType:t,markers:this.markers,map:this.adapter,selectedMarkerId:this.selectedMarkerId,zoom:(s=e==null?void 0:e.zoom)!=null?s:0,collisionThresholdPx:r,dotCollisionThresholdPx:n}),(i=this.markerRenderer)==null||i.render(this.clusterItems),(m=(o=this.options).onClusterUpdate)==null||m.call(o,this.clusterItems,e)}destroy(){var e;if(!this.destroyed){(e=this.markerRenderer)==null||e.destroy();for(let t of this.cleanupFns)try{t()}catch{}this.cleanupFns.length=0,this.clusterItems=[],this.markers=[],this.destroyed=!0}}resolvePrimaryType(){var e,t,r;return(r=(t=this.primaryType)!=null?t:(e=this.markers.find(n=>n.type))==null?void 0:e.type)!=null?r:Z}safeExtractViewState(){try{return K(this.adapter)}catch{return null}}resolveCollisionOverrides(e){if(!e)return{collisionPx:void 0,dotPx:void 0};let t=this.options.clusterRadiusMeters;if(!t||!Number.isFinite(t)||t<=0)return{collisionPx:void 0,dotPx:void 0};let r=J(t,e.latitude,e.zoom);if(!Number.isFinite(r)||r<=0)return{collisionPx:void 0,dotPx:void 0};let n=Math.max(32,Math.round(r)),s=Math.max(48,n);return{collisionPx:n,dotPx:s}}attachMapLibreListeners(e){if(!e||typeof e.on!="function")return;let t=()=>this.refresh();["move","zoom","dragend","pitch","rotate"].forEach(n=>{e.on(n,t),this.cleanupFns.push(()=>{typeof e.off=="function"&&e.off(n,t)})})}attachGoogleMapsListeners(e){let t=()=>this.refresh(),r=["center_changed","zoom_changed","drag","heading_changed","tilt_changed"],n=[];r.forEach(s=>{let i=e.addListener(s,t);n.push(i)}),this.cleanupFns.push(()=>{n.forEach(s=>{try{s.remove()}catch{}})})}ensureAlive(){if(this.destroyed)throw new Error("MapFirstCore instance has been destroyed")}};function $(a){return a.platform==="maplibre"}function U(a){return a.platform==="google"}function K(a){let e=a.getCenter();return{longitude:e.lng,latitude:e.lat,zoom:a.getZoom(),bearing:a.getBearing(),pitch:a.getPitch()}}var W=[{zoom:6,threshold:120},{zoom:8,threshold:108},{zoom:10,threshold:92},{zoom:12,threshold:80},{zoom:14,threshold:68},{zoom:16,threshold:56}];function S(a){for(let e of W)if(a<=e.zoom)return e.threshold;return 48}function D({primaryType:a,markers:e,map:t,selectedMarkerId:r,zoom:n,collisionThresholdPx:s,dotCollisionThresholdPx:i}){if(!e.length)return[];if(!t)return e.map(p=>({kind:"primary",marker:p,key:`primary-${p.tripadvisor_id}`}));let o=e.map((p,d)=>{let l=p.location;if(typeof(l==null?void 0:l.lon)!="number"||typeof(l==null?void 0:l.lat)!="number")return null;let{x:c,y:v}=t.project([l.lon,l.lat]);return{marker:p,index:d,x:c,y:v}}).filter(p=>!!p);if(!o.length)return[];let m=S(n),y=X(n),h=o.map((p,d)=>d),b=p=>h[p]===p?p:(h[p]=b(h[p]),h[p]),_=(p,d)=>{let l=b(p),c=b(d);l!==c&&(h[c]=l)};for(let p=0;p<o.length;p+=1)for(let d=p+1;d<o.length;d+=1){let l=o[p].x-o[d].x,c=o[p].y-o[d].y;Math.hypot(l,c)<=m&&_(p,d)}let I=new Map;for(let p of o){let d=b(p.index),l=I.get(d);l?l.push(p):I.set(d,[p])}let f=[];return I.forEach(p=>{if(p.length===1){let[{marker:u}]=p;f.push({kind:"primary",marker:u,key:`primary-${u.tripadvisor_id}`});return}let d=[...p].sort((u,T)=>q(T.marker,u.marker,a)),[l,...c]=d;if(f.push({kind:"primary",marker:l.marker,key:`primary-${l.marker.tripadvisor_id}`}),!c.length)return;let v=[],w=[];if(c.forEach(u=>{if(r&&u.marker.tripadvisor_id===r){f.push({kind:"primary",marker:u.marker,key:`primary-${u.marker.tripadvisor_id}`});return}Y(l,u)<=y?v.push(u):w.push(u)}),v.forEach(u=>{f.push({kind:"dot",marker:u.marker,key:`dot-${u.marker.tripadvisor_id}`,parentId:l.marker.tripadvisor_id})}),w.length){let u=D({markers:w.map(T=>T.marker),map:t,selectedMarkerId:r,zoom:n,primaryType:a,collisionThresholdPx:s,dotCollisionThresholdPx:i});f.push(...u)}}),f}function Y(a,e){return Math.hypot(a.x-e.x,a.y-e.y)}function X(a){let e=S(a);return Math.max(48,e)}function q(a,e,t){var m,y;let r=a.type===t,n=e.type===t;if(r&&!n)return 1;if(!r&&n)return-1;let s=N(a)-N(e);if(s!==0)return s;let i=O(a)-O(e);if(i!==0)return i;let o=((m=a.reviews)!=null?m:0)-((y=e.reviews)!=null?y:0);return o!==0?o:a.tripadvisor_id-e.tripadvisor_id}function N(a){if(typeof a.rating=="number")return a.rating;if(a.rating===void 0||a.rating===null)return-1/0;let e=Number(a.rating);return Number.isNaN(e)?-1/0:e}function O(a){var t,r,n;if(!((r=(t=a.pricing)==null?void 0:t.offer)!=null&&r.price))return-1/0;let e=Number(((n=a.pricing.offer.displayPrice)!=null?n:"0").replace(/[^0-9.,-]+/g,"").replace(/,/g,""));return Number.isNaN(e)?-1/0:e}function J(a,e,t){let r=Math.cos(e*Math.PI/180)*2*Math.PI*6378137/(256*2**t);return!Number.isFinite(r)||r<=0?a:a/r}return H(Q);})();
//# sourceMappingURL=index.global.js.map